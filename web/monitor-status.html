<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´¦å·çŠ¶æ€ç›‘æ§</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        h1 {
            color: #333;
            margin-bottom: 5px;
        }
        
        .refresh-info {
            color: #666;
            font-size: 14px;
        }
        
        .refresh-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .refresh-btn:hover {
            background: #5568d3;
        }
        
        .accounts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        
        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .header {
                padding: 15px;
                flex-direction: column;
                gap: 15px;
            }
            
            h1 {
                font-size: 20px;
            }
            
            .refresh-info {
                font-size: 12px;
            }
            
            .accounts-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .account-card {
                padding: 15px;
            }
            
            .account-name {
                font-size: 16px;
            }
            
            .section-title {
                font-size: 13px;
            }
            
            .status-item {
                padding: 6px 10px;
            }
            
            .status-label,
            .status-value {
                font-size: 12px;
            }
            
            .badge {
                font-size: 11px;
                padding: 2px 6px;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 8px;
            }
            
            .header {
                padding: 12px;
            }
            
            h1 {
                font-size: 18px;
            }
            
            .account-card {
                padding: 12px;
            }
        }
        
        .account-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .account-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .account-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        
        .update-time {
            font-size: 12px;
            color: #999;
        }
        
        .status-section {
            margin-bottom: 15px;
        }
        
        .section-title {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .progress-bar {
            width: 100%;
            height: 24px;
            background: #f0f0f0;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .progress-text {
            position: absolute;
            width: 100%;
            text-align: center;
            font-size: 12px;
            font-weight: bold;
            color: #333;
            line-height: 24px;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: #f9fafb;
            border-radius: 5px;
            margin-bottom: 6px;
        }
        
        .status-label {
            font-size: 13px;
            color: #666;
        }
        
        .status-value {
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }
        
        .status-value.time {
            font-family: 'Courier New', monospace;
            color: #3b82f6;
        }
        
        .status-value.success {
            color: #10b981;
        }
        
        .status-value.warning {
            color: #f59e0b;
        }
        
        .status-value.danger {
            color: #ef4444;
        }
        
        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .badge.success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .badge.danger {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .badge.warning {
            background: #fef3c7;
            color: #92400e;
        }
        
        .no-data {
            text-align: center;
            color: #999;
            padding: 40px;
            background: white;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>ğŸ® è´¦å·çŠ¶æ€ç›‘æ§</h1>
                <div class="refresh-info">
                    æœ€åæ›´æ–°: <span id="lastUpdate">-</span>
                </div>
            </div>
            <button class="refresh-btn" onclick="loadData()">ğŸ”„ åˆ·æ–°</button>
        </div>
        
        <div class="accounts-grid" id="accountsGrid">
            <div class="no-data">åŠ è½½ä¸­...</div>
        </div>
    </div>
    
    <script>
        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(seconds) {
            if (!seconds || seconds <= 0) return '00:00:00';
            
            const h = Math.floor(seconds / 3600).toString().padStart(2, '0');
            const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
            const s = Math.floor(seconds % 60).toString().padStart(2, '0');
            return `${h}:${m}:${s}`;
        }
        
        // æ ¼å¼åŒ–ç›¸å¯¹æ—¶é—´
        function formatRelativeTime(timestamp) {
            if (!timestamp) return 'ä»æœª';
            
            const diff = Date.now() - timestamp;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (days > 0) return `${days}å¤©å‰`;
            if (hours > 0) return `${hours}å°æ—¶å‰`;
            if (minutes > 0) return `${minutes}åˆ†é’Ÿå‰`;
            return 'åˆšåˆš';
        }
        
        // å®æ—¶å€’è®¡æ—¶å¯¹è±¡
        let countdowns = {};
        
        // åŠ è½½æ•°æ®
        async function loadData() {
            try {
                const timestamp = new Date().getTime();
                const response = await fetch(`/data/account-status.json?t=${timestamp}`);
                const data = await response.json();
                
                // åœæ­¢æ—§çš„å€’è®¡æ—¶
                Object.keys(countdowns).forEach(key => {
                    if (countdowns[key]) clearInterval(countdowns[key]);
                });
                countdowns = {};
                
                // æ¸²æŸ“è´¦å·å¡ç‰‡
                renderAccounts(data);
                
                // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
                document.getElementById('lastUpdate').textContent = new Date().toLocaleString('zh-CN');
                
            } catch (error) {
                document.getElementById('accountsGrid').innerHTML = 
                    '<div class="no-data">æš‚æ— è´¦å·çŠ¶æ€æ•°æ®<br><small>è¯·å…ˆæ‰§è¡Œä»»åŠ¡ä»¥æ”¶é›†çŠ¶æ€ä¿¡æ¯</small></div>';
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
            }
        }
        
        // æ¸²æŸ“è´¦å·åˆ—è¡¨
        function renderAccounts(data) {
            const grid = document.getElementById('accountsGrid');
            
            const accounts = Object.keys(data);
            if (accounts.length === 0) {
                grid.innerHTML = '<div class="no-data">æš‚æ— è´¦å·çŠ¶æ€æ•°æ®</div>';
                return;
            }
            
            let html = '';
            accounts.forEach(accountName => {
                const status = data[accountName];
                html += renderAccountCard(accountName, status);
            });
            
            grid.innerHTML = html;
            
            // å¯åŠ¨å®æ—¶å€’è®¡æ—¶
            accounts.forEach(accountName => {
                const status = data[accountName];
                startCountdown(accountName, status);
            });
        }
        
        // æ¸²æŸ“å•ä¸ªè´¦å·å¡ç‰‡
        function renderAccountCard(accountName, status) {
            const dailyPoint = status.dailyTask?.dailyPoint || 0;
            // ä»»åŠ¡æ€»åˆ†æ˜¯110åˆ†ï¼Œ70% = 77åˆ†
            const æ€»åˆ†æ•° = 110;
            const å®Œæˆåˆ†æ•° = Math.min(dailyPoint, æ€»åˆ†æ•°);
            const progressPercent = Math.min((å®Œæˆåˆ†æ•° / æ€»åˆ†æ•°) * 100, 100);
            
            const bottleRunning = status.bottleHelper?.isRunning || false;
            const bottleTime = status.bottleHelper?.remainingTime || 0;
            
            const hangUpTotal = status.hangUp?.totalTime || 0;
            const hangUpRemaining = status.hangUp?.remainingTime || 0;
            const hangUpElapsed = status.hangUp?.elapsedTime || 0;
            
            const isSignedIn = status.signin?.isSignedIn || false;
            const hasAnswered = status.study?.hasAnswered || false;
            const studyScore = status.study?.score || 0;
            const hasPlayedCar = status.carKing?.hasPlayed || false;
            
            // ç«æŠ€åœºçŠ¶æ€
            const arenaSuccess = status.arena?.successCount || 0;
            const arenaAttempt = status.arena?.attemptCount || 0;
            const arenaStatus = status.arena?.status || 'pending';
            const arenaLastTime = status.arena?.lastExecuteTime || null;
            
            const updateTime = formatRelativeTime(status.lastUpdate);
            
            return `
                <div class="account-card">
                    <div class="account-header">
                        <div class="account-name">${accountName}</div>
                        <div class="update-time">${updateTime}</div>
                    </div>
                    
                    <!-- æ¯æ—¥ä»»åŠ¡è¿›åº¦ -->
                    <div class="status-section">
                        <div class="section-title">ğŸ“ æ¯æ—¥ä»»åŠ¡è¿›åº¦</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progressPercent}%"></div>
                            <div class="progress-text">${å®Œæˆåˆ†æ•°}/${æ€»åˆ†æ•°} (${Math.round(progressPercent)}%)</div>
                        </div>
                    </div>
                    
                    <!-- ç›ç½æœºå™¨äºº -->
                    <div class="status-section">
                        <div class="section-title">ğŸ¤– ç›ç½æœºå™¨äºº</div>
                        <div class="status-item">
                            <span class="status-label">è¿è¡ŒçŠ¶æ€</span>
                            <span class="badge ${bottleRunning ? 'success' : 'danger'}">
                                ${bottleRunning ? 'è¿è¡Œä¸­' : 'å·²åœæ­¢'}
                            </span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">å‰©ä½™æ—¶é—´</span>
                            <span class="status-value time" id="bottle-${accountName}">
                                ${formatTime(bottleTime)}
                            </span>
                        </div>
                    </div>
                    
                    <!-- æŒ‚æœºçŠ¶æ€ -->
                    <div class="status-section">
                        <div class="section-title">â° æŒ‚æœºçŠ¶æ€</div>
                        <div class="status-item">
                            <span class="status-label">æ€»æŒ‚æœºæ—¶é—´</span>
                            <span class="status-value time">
                                ${formatTime(hangUpTotal)}
                            </span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">å·²æŒ‚æœº</span>
                            <span class="status-value time" id="elapsed-${accountName}">
                                ${formatTime(hangUpElapsed)}
                            </span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">å‰©ä½™æ—¶é—´</span>
                            <span class="status-value time" id="hangup-${accountName}">
                                ${formatTime(hangUpRemaining)}
                            </span>
                        </div>
                    </div>
                    
                    <!-- å…¶ä»–çŠ¶æ€ -->
                    <div class="status-section">
                        <div class="section-title">ğŸ“‹ å…¶ä»–çŠ¶æ€</div>
                        <div class="status-item">
                            <span class="status-label">ä»Šæ—¥ç­¾åˆ°</span>
                            <span class="badge ${isSignedIn ? 'success' : 'warning'}">
                                ${isSignedIn ? 'å·²ç­¾åˆ°' : 'æœªç­¾åˆ°'}
                            </span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">æœ¬å‘¨ç­”é¢˜</span>
                            <span class="badge ${hasAnswered ? 'success' : 'warning'}">
                                ${hasAnswered ? `å·²å®Œæˆ(${studyScore}åˆ†)` : 'æœªå®Œæˆ'}
                            </span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">ç–¯ç‹‚èµ›è½¦</span>
                            <span class="badge ${hasPlayedCar ? 'success' : 'warning'}">
                                ${hasPlayedCar ? 'æœ¬å‘¨å·²å®Œæˆ' : 'æœªå®Œæˆ'}
                            </span>
                        </div>
                    </div>
                    
                    <!-- ç«æŠ€åœºçŠ¶æ€ -->
                    <div class="status-section">
                        <div class="section-title">âš”ï¸ ç«æŠ€åœº</div>
                        <div class="status-item">
                            <span class="status-label">ä»Šæ—¥æˆ˜æ–—</span>
                            <span class="badge ${
                                arenaStatus === 'success' ? 'success' : 
                                arenaStatus === 'partial' ? 'warning' : 
                                arenaStatus === 'failed' ? 'danger' : 'secondary'
                            }">
                                ${
                                    arenaStatus === 'success' ? `âœ“ ${arenaSuccess}/3` :
                                    arenaStatus === 'partial' ? `âš  ${arenaSuccess}/3` :
                                    arenaStatus === 'failed' ? `âœ— ${arenaSuccess}/3` :
                                    'å¾…æ‰§è¡Œ'
                                }
                            </span>
                        </div>
                        ${
                            arenaAttempt > 0 ? `
                            <div class="status-item">
                                <span class="status-label">å°è¯•æ¬¡æ•°</span>
                                <span class="status-value">${arenaAttempt}æ¬¡</span>
                            </div>
                            ` : ''
                        }
                    </div>
                </div>
            `;
        }
        
        // å¯åŠ¨å€’è®¡æ—¶
        function startCountdown(accountName, status) {
            let bottleRemaining = status.bottleHelper?.remainingTime || 0;
            let hangUpRemaining = status.hangUp?.remainingTime || 0;
            let hangUpElapsed = status.hangUp?.elapsedTime || 0;
            
            countdowns[accountName] = setInterval(() => {
                // ç›ç½å€’è®¡æ—¶
                if (bottleRemaining > 0) {
                    bottleRemaining--;
                    const elem = document.getElementById(`bottle-${accountName}`);
                    if (elem) elem.textContent = formatTime(bottleRemaining);
                }
                
                // æŒ‚æœºå€’è®¡æ—¶
                if (hangUpRemaining > 0) {
                    hangUpRemaining--;
                    hangUpElapsed++;
                    
                    const remainElem = document.getElementById(`hangup-${accountName}`);
                    const elapsedElem = document.getElementById(`elapsed-${accountName}`);
                    
                    if (remainElem) remainElem.textContent = formatTime(hangUpRemaining);
                    if (elapsedElem) elapsedElem.textContent = formatTime(hangUpElapsed);
                }
            }, 1000);
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½æ•°æ®
        loadData();
        
        // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡
        setInterval(loadData, 30000);
    </script>
</body>
</html>
