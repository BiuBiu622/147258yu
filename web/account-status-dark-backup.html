<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆåŠ©æ‰‹</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: #0f1419; color: #e7e9ea; min-height: 100vh; }
        
        /* å¯¼èˆªæ  */
        .navbar { background: #16202a; border-bottom: 1px solid #2f3b47; padding: 0 20px; position: sticky; top: 0; z-index: 100; }
        .navbar-inner { max-width: 1400px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; height: 50px; }
        .navbar-brand { font-size: 16px; font-weight: 600; color: #e7e9ea; text-decoration: none; display: flex; align-items: center; gap: 8px; }
        .navbar-nav { display: flex; align-items: center; gap: 2px; }
        .nav-link { color: #8b98a5; text-decoration: none; padding: 8px 14px; border-radius: 6px; font-size: 13px; font-weight: 500; transition: all 0.15s; cursor: pointer; }
        .nav-link:hover { background: #1d2a36; color: #e7e9ea; }
        .nav-link.active { background: #1d9bf0; color: white; }
        
        .main-content { padding: 20px; max-width: 1400px; margin: 0 auto; }
        .page { display: none; }
        .page.active { display: block; }
        
        /* é€šç”¨å¤´éƒ¨ */
        .page-header { background: #16202a; border-radius: 10px; padding: 16px 20px; margin-bottom: 16px; border: 1px solid #2f3b47; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px; }
        .page-header h2 { font-size: 18px; color: #e7e9ea; }
        .header-right { display: flex; gap: 12px; align-items: center; }
        .stat-box { text-align: center; padding: 8px 16px; background: #1d2a36; border-radius: 6px; border: 1px solid #2f3b47; }
        .stat-value { font-size: 20px; font-weight: bold; color: #1d9bf0; }
        .stat-label { font-size: 11px; color: #71767b; margin-top: 2px; }
        
        /* æŒ‰é’® */
        .btn { background: #1d9bf0; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.15s; }
        .btn:hover { background: #1a8cd8; }
        .btn.success { background: #00ba7c; }
        .btn.success:hover { background: #00a06a; }
        .btn.secondary { background: #2f3b47; color: #e7e9ea; }
        .btn.secondary:hover { background: #3d4f5f; }
        .btn.danger { background: #f4212e; }
        .btn.danger:hover { background: #dc1e28; }
        
        /* è¡¨æ ¼ */
        .table-container { background: #16202a; border-radius: 10px; border: 1px solid #2f3b47; overflow-x: auto; }
        .status-table { width: 100%; border-collapse: collapse; font-size: 13px; }
        .status-table th { background: #1d2a36; padding: 12px 14px; text-align: center; font-weight: 500; color: #71767b; border-bottom: 1px solid #2f3b47; white-space: nowrap; text-transform: uppercase; font-size: 11px; letter-spacing: 0.5px; }
        .status-table td { padding: 12px 14px; text-align: center; border-bottom: 1px solid #2f3b47; vertical-align: middle; }
        .status-table tbody tr { transition: background 0.15s; }
        .status-table tbody tr:hover { background: #1d2a36; }
        .status-table tr.expanded { background: #1d2a36; }
        .account-name-cell { font-weight: 600; color: #1d9bf0; text-align: left !important; padding-left: 16px !important; cursor: pointer; }
        .account-name-cell:hover { text-decoration: underline; }
        .expand-icon { margin-right: 6px; transition: transform 0.2s; display: inline-block; }
        .expand-icon.open { transform: rotate(90deg); }
        
        /* å¾½ç«  */
        .badge { display: inline-block; padding: 4px 10px; border-radius: 4px; font-size: 12px; font-weight: 500; white-space: nowrap; }
        .badge.success { background: rgba(0, 186, 124, 0.15); color: #00ba7c; }
        .badge.danger { background: rgba(244, 33, 46, 0.15); color: #f4212e; }
        .badge.warning { background: rgba(255, 212, 0, 0.15); color: #ffd400; }
        .badge.gray { background: rgba(113, 118, 123, 0.2); color: #71767b; }
        .badge.info { background: rgba(29, 155, 240, 0.15); color: #1d9bf0; }
        
        .time-cell { font-family: 'SF Mono', 'Consolas', monospace; font-size: 12px; color: #00ba7c; }
        
        /* è¿›åº¦æ¡ */
        .progress-container { width: 80px; height: 20px; background: #2f3b47; border-radius: 10px; overflow: hidden; position: relative; }
        .progress-bar { height: 100%; border-radius: 10px; transition: width 0.3s ease; position: relative; }
        .progress-bar.low { background: linear-gradient(90deg, #f4212e, #dc1e28); }
        .progress-bar.medium { background: linear-gradient(90deg, #ffd400, #e6bf00); }
        .progress-bar.high { background: linear-gradient(90deg, #1d9bf0, #1a8cd8); }
        .progress-bar.complete { background: linear-gradient(90deg, #00ba7c, #00a06a); }
        .progress-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 11px; font-weight: 600; color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.5); z-index: 1; }
        
        /* æ“ä½œæŒ‰é’® */
        .action-btn { background: transparent; border: 1px solid #2f3b47; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; margin: 0 2px; transition: all 0.15s; color: #71767b; }
        .action-btn:hover { background: #1d2a36; border-color: #3d4f5f; }
        .action-btn.settings { color: #1d9bf0; border-color: rgba(29, 155, 240, 0.3); }
        .action-btn.settings:hover { background: rgba(29, 155, 240, 0.1); border-color: #1d9bf0; }
        
        /* å±•å¼€è¯¦æƒ…è¡Œ */
        .detail-row { display: none; }
        .detail-row.show { display: table-row; }
        .detail-row td { padding: 0; background: #1e3a4d; }
        .detail-panel { padding: 16px 20px; border-left: 3px solid #1d9bf0; background: rgba(29, 155, 240, 0.08); }
        .detail-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 12px; }
        .detail-item { background: #253341; padding: 10px 14px; border-radius: 6px; text-align: center; min-height: 60px; display: flex; flex-direction: column; justify-content: center; }
        .detail-item-label { font-size: 11px; color: #71767b; margin-bottom: 4px; }
        .detail-item-value { font-size: 12px; font-weight: 500; line-height: 1.3; word-break: break-all; }
        .detail-item-value .badge { font-size: 11px; padding: 3px 8px; line-height: 1.2; }
        
        /* é…ç½®é¢æ¿ */
        .config-row { display: none; }
        .config-row.show { display: table-row; }
        .config-row td { padding: 0; background: #1d2a36; }
        .config-panel { padding: 16px 20px; border-top: 2px solid #1d9bf0; background: #1d2a36; }
        .config-panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding-bottom: 10px; border-bottom: 1px solid #2f3b47; }
        .config-panel-title { font-size: 14px; font-weight: 500; color: #e7e9ea; }
        .config-panel-actions { display: flex; gap: 8px; }
        
        .config-row-group { display: flex; flex-wrap: wrap; align-items: center; padding: 10px 14px; background: #253341; border-radius: 6px; margin-bottom: 6px; border: 1px solid #2f3b47; gap: 6px 16px; }
        .config-row-title { font-size: 13px; font-weight: 500; color: #1d9bf0; min-width: 70px; display: flex; align-items: center; gap: 5px; }
        .config-row-subtitle { font-size: 12px; font-weight: 400; color: #8b98a5; width: 100%; margin-top: 4px; padding-top: 6px; border-top: 1px dashed #2f3b47; }
        .config-row-items { display: flex; flex-wrap: wrap; align-items: center; gap: 6px 14px; flex: 1; }
        .config-inline-item { display: inline-flex; align-items: center; gap: 5px; font-size: 13px; color: #e7e9ea; white-space: nowrap; }
        .config-inline-item .label { color: #8b98a5; }
        .config-divider { width: 1px; height: 16px; background: #2f3b47; }
        .merchant-tag { font-size: 12px; font-weight: 500; padding: 2px 8px; border-radius: 4px; margin-right: 6px; }
        .merchant-tag.green { color: #10b981; background: rgba(16,185,129,0.15); }
        .merchant-tag.yellow { color: #f59e0b; background: rgba(245,158,11,0.15); }
        .merchant-tag.red { color: #ef4444; background: rgba(239,68,68,0.15); }
        
        .simple-tasks-row { display: flex; flex-wrap: wrap; align-items: center; gap: 6px 16px; padding: 10px 14px; background: #253341; border-radius: 6px; margin-top: 6px; border: 1px solid #2f3b47; }
        .simple-task-item { display: inline-flex; align-items: center; gap: 5px; font-size: 13px; }
        .simple-task-label { color: #8b98a5; }
        
        /* å¼€å…³ */
        .toggle-switch { position: relative; display: inline-block; width: 28px; height: 15px; flex-shrink: 0; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; position: absolute; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #3d4f5f; transition: 0.2s; border-radius: 15px; }
        .slider:before { position: absolute; content: ""; height: 11px; width: 11px; left: 2px; bottom: 2px; background-color: #8b98a5; transition: 0.2s; border-radius: 50%; }
        input:checked + .slider { background-color: #00ba7c; }
        input:checked + .slider:before { transform: translateX(13px); background-color: white; }
        
        /* æ•°å­—è¾“å…¥ */
        .number-input-group { display: inline-flex; align-items: center; height: 24px; }
        .number-input-group input { width: 32px; height: 24px; padding: 0; border: 1px solid #2f3b47; border-left: none; border-right: none; text-align: center; font-size: 12px; color: #e7e9ea; background: #253341; -moz-appearance: textfield; appearance: textfield; }
        .number-input-group input::-webkit-outer-spin-button, .number-input-group input::-webkit-inner-spin-button { -webkit-appearance: none; appearance: none; }
        .number-btn { width: 22px; height: 24px; border: 1px solid #2f3b47; background: #253341; color: #8b98a5; cursor: pointer; font-size: 12px; display: flex; align-items: center; justify-content: center; }
        .number-btn:hover { background: #2f3b47; color: #e7e9ea; }
        .number-btn.decrease { border-radius: 4px 0 0 4px; }
        .number-btn.increase { border-radius: 0 4px 4px 0; }
        
        /* ä¿å­˜æç¤º */
        .save-status { position: fixed; top: 60px; right: 20px; padding: 12px 20px; background: #00ba7c; color: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); display: none; z-index: 1000; font-weight: 500; }
        .save-status.show { display: block; animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        
        .no-data { text-align: center; padding: 60px 20px; color: #71767b; }
        .no-data-icon { font-size: 48px; margin-bottom: 15px; }
        .no-data-text { font-size: 16px; margin-bottom: 5px; color: #e7e9ea; }
        .no-data-hint { font-size: 13px; }

        /* BINç®¡ç†é¡µé¢ */
        .upload-area { background: #1d2a36; border: 2px dashed #2f3b47; border-radius: 10px; padding: 40px; text-align: center; cursor: pointer; transition: all 0.3s; margin-bottom: 16px; }
        .upload-area:hover { border-color: #1d9bf0; background: #253341; }
        .upload-area.dragover { border-color: #1d9bf0; background: #253341; }
        .upload-icon { font-size: 48px; margin-bottom: 10px; }
        .upload-text { color: #e7e9ea; font-size: 15px; }
        .upload-hint { color: #71767b; font-size: 13px; margin-top: 8px; }
        
        .file-list { background: #16202a; border-radius: 10px; padding: 20px; border: 1px solid #2f3b47; }
        .file-list-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid #2f3b47; }
        .file-list-header h3 { font-size: 15px; color: #e7e9ea; }
        .file-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #2f3b47; transition: background 0.2s; }
        .file-item:hover { background: #1d2a36; }
        .file-item:last-child { border-bottom: none; }
        .file-info { flex: 1; }
        .file-name { font-size: 14px; color: #e7e9ea; font-weight: 500; margin-bottom: 4px; }
        .file-meta { font-size: 12px; color: #71767b; }
        .file-actions { display: flex; gap: 8px; align-items: center; }
        .hangup-label { font-size: 12px; color: #71767b; margin-right: 4px; }
        
        /* æ—¥å¿—é¡µé¢ */
        .log-container { background: #0d1117; border: 1px solid #2f3b47; border-radius: 8px; padding: 16px; height: 70vh; overflow-y: auto; font-family: 'SF Mono', 'Consolas', monospace; font-size: 12px; line-height: 1.6; }
        .log-line { padding: 2px 0; white-space: pre-wrap; word-break: break-all; }
        .log-line:hover { background: #161b22; }
        .log-info { color: #58a6ff; }
        .log-ok { color: #3fb950; }
        .log-error { color: #f85149; }
        .log-warn { color: #d29922; }
        .timestamp { color: #6e7681; }
        
        /* æŒ‚æœºæ—¥å¿—é¡µé¢ */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 16px; }
        .stat-card { background: linear-gradient(135deg, #1d9bf0 0%, #1a8cd8 100%); padding: 16px; border-radius: 8px; color: white; }
        .stat-card.success { background: linear-gradient(135deg, #00ba7c 0%, #00a06a 100%); }
        .stat-card.warning { background: linear-gradient(135deg, #ffd400 0%, #e6bf00 100%); color: #0f1419; }
        .stat-card.danger { background: linear-gradient(135deg, #f4212e 0%, #dc1e28 100%); }
        .stat-card .stat-label { font-size: 12px; opacity: 0.9; margin-bottom: 6px; }
        .stat-card .stat-value { font-size: 28px; font-weight: 700; }
        
        .account-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px; }
        .account-card { background: #1d2a36; border-radius: 8px; padding: 14px; border-left: 3px solid #1d9bf0; }
        .account-card.hangup-on { border-left-color: #00ba7c; }
        .account-card.hangup-off { border-left-color: #71767b; }
        .account-card-name { font-size: 14px; font-weight: 600; color: #e7e9ea; margin-bottom: 10px; }
        .account-card-status { display: flex; flex-direction: column; gap: 6px; font-size: 12px; }
        .status-row { display: flex; justify-content: space-between; align-items: center; }
        .status-row .label { color: #71767b; }
        .status-row .value { color: #e7e9ea; }
        .status-row .value.online { color: #00ba7c; }
        .status-row .value.offline { color: #f4212e; }
        .status-row .value.waiting { color: #ffd400; }
        
        input[type="file"] { display: none; }
        
        @media (max-width: 768px) {
            .navbar-inner { flex-direction: column; height: auto; padding: 10px 0; gap: 10px; }
            .navbar-nav { flex-wrap: wrap; justify-content: center; }
            .page-header { flex-direction: column; align-items: flex-start; }
            .header-right { width: 100%; flex-wrap: wrap; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .account-grid { grid-template-columns: 1fr; }
            .detail-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-inner">
            <a href="/" class="navbar-brand">ğŸ’ æ¸¸æˆåŠ©æ‰‹</a>
            <div class="navbar-nav">
                <div class="nav-link active" onclick="showPage('status')">ğŸ“Š è´¦å·çŠ¶æ€</div>
                <div class="nav-link" onclick="showPage('tools')">ğŸ§° å·¥å…·ç®±</div>
                <div class="nav-link" onclick="showPage('bin')">ğŸ“ BINç®¡ç†</div>
                <div class="nav-link" onclick="showPage('logs')">ğŸ“ è¿è¡Œæ—¥å¿—</div>
                <div class="nav-link" onclick="showPage('hangup')">ğŸ® æŒ‚æœºæ—¥å¿—</div>
            </div>
        </div>
    </nav>
    
    <div class="main-content">
        <div class="save-status" id="saveStatus">âœ“ ä¿å­˜æˆåŠŸ</div>

        <!-- è´¦å·çŠ¶æ€é¡µ -->
        <div id="page-status" class="page active">
            <div class="page-header">
                <h2>ğŸ“Š è´¦å·çŠ¶æ€ç›‘æ§</h2>
                <div class="header-right">
                    <div class="stat-box"><div class="stat-value" id="totalAccounts">0</div><div class="stat-label">æ€»è´¦å·</div></div>
                    <div class="stat-box"><div class="stat-value" id="withStatus">0</div><div class="stat-label">æœ‰çŠ¶æ€</div></div>
                    <button class="btn" onclick="loadStatusData()">ğŸ”„ åˆ·æ–°</button>
                </div>
            </div>
            <div class="table-container">
                <table class="status-table" id="statusTable">
                    <thead><tr><th style="text-align:left;padding-left:16px;">è´¦å·</th><th>æ¯æ—¥ä»»åŠ¡</th><th>ç›ç½</th><th>æŒ‚æœº</th><th>ç«æŠ€åœº</th><th>æ“ä½œ</th></tr></thead>
                    <tbody id="statusTableBody"><tr><td colspan="6"><div class="no-data"><div class="no-data-icon">â³</div><div class="no-data-text">åŠ è½½ä¸­...</div></div></td></tr></tbody>
                </table>
            </div>
        </div>
        
        <!-- BINç®¡ç†é¡µ -->
        <div id="page-bin" class="page">
            <div class="page-header"><h2>ğŸ“ BINæ–‡ä»¶ç®¡ç†</h2></div>
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">ğŸ“¤</div>
                <div class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½BINæ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ </div>
                <div class="upload-hint">æ”¯æŒ .bin æ ¼å¼æ–‡ä»¶ï¼Œä¸Šä¼ åè‡ªåŠ¨è½¬æ¢Token</div>
                <input type="file" id="fileInput" accept=".bin" multiple>
            </div>
            <div class="file-list">
                <div class="file-list-header"><h3>æ–‡ä»¶åˆ—è¡¨</h3><button class="btn" onclick="loadBinFiles()">ğŸ”„ åˆ·æ–°</button></div>
                <div id="fileListContent"><div class="no-data">åŠ è½½ä¸­...</div></div>
            </div>
        </div>
        
        <!-- è¿è¡Œæ—¥å¿—é¡µ -->
        <div id="page-logs" class="page">
            <div class="page-header">
                <h2>ğŸ“ è°ƒåº¦å™¨æ—¥å¿—</h2>
                <div class="header-right">
                    <button class="btn" id="autoLogBtn" onclick="toggleAutoLog()">ğŸ”„ è‡ªåŠ¨åˆ·æ–°</button>
                    <button class="btn secondary" onclick="loadLogs()">åˆ·æ–°</button>
                </div>
            </div>
            <div class="log-container" id="logContainer"><div class="no-data">åŠ è½½ä¸­...</div></div>
        </div>
        
        <!-- æŒ‚æœºæ—¥å¿—é¡µ -->
        <div id="page-hangup" class="page">
            <div class="page-header">
                <h2>ğŸ® æŒ‚æœºçŠ¶æ€</h2>
                <div class="header-right">
                    <button class="btn" id="autoHangupBtn" onclick="toggleAutoHangup()">ğŸ”„ è‡ªåŠ¨åˆ·æ–°</button>
                    <button class="btn secondary" onclick="loadHangupData()">åˆ·æ–°</button>
                </div>
            </div>
            <div class="stats-grid" id="hangupStats">
                <div class="stat-card"><div class="stat-label">æ€»è´¦å·</div><div class="stat-value" id="hTotal">0</div></div>
                <div class="stat-card success"><div class="stat-label">å·²å¯ç”¨</div><div class="stat-value" id="hEnabled">0</div></div>
                <div class="stat-card warning"><div class="stat-label">åœ¨çº¿ä¸­</div><div class="stat-value" id="hOnline">0</div></div>
                <div class="stat-card danger"><div class="stat-label">ç¦»çº¿</div><div class="stat-value" id="hOffline">0</div></div>
            </div>
            <div class="file-list" style="margin-bottom:16px;">
                <div class="file-list-header"><h3>å®æ—¶æ—¥å¿—</h3></div>
                <div class="log-container" id="hangupLogContainer" style="height:300px;"><div class="no-data">åŠ è½½ä¸­...</div></div>
            </div>
            <div class="file-list">
                <div class="file-list-header"><h3>è´¦å·çŠ¶æ€</h3></div>
                <div class="account-grid" id="hangupAccountGrid"><div class="no-data">åŠ è½½ä¸­...</div></div>
            </div>
        </div>
        
        <!-- å·¥å…·ç®±é¡µ -->
        <div id="page-tools" class="page">
            <iframe id="toolsFrame" src="tools.html" style="width:100%;height:calc(100vh - 70px);border:none;"></iframe>
        </div>
    </div>
    <script>
        // ==================== éƒ¨ç½²é…ç½®åŒºåŸŸ ====================
        // éƒ¨ç½²åˆ°æœåŠ¡å™¨æ—¶ï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ä»¥ä¸‹é…ç½®
        
        // æ–¹å¼1: ç›´æ¥æŒ‡å®šAPIæœåŠ¡å™¨åœ°å€ï¼ˆæ¨èç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰
        // const API_BASE = 'http://your-server-ip:3000';
        
        // æ–¹å¼2: ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚æœWebæœåŠ¡å™¨ä»£ç†äº†APIè¯·æ±‚ï¼‰
        // const API_BASE = '';  // ç©ºå­—ç¬¦ä¸²è¡¨ç¤ºä½¿ç”¨ç›¸å¯¹è·¯å¾„
        
        // æ–¹å¼3: åŠ¨æ€è·å–ï¼ˆé»˜è®¤ï¼Œé€‚ç”¨äºå¼€å‘ç¯å¢ƒï¼‰
        function getApiBase() {
            // å¦‚æœä½ åœ¨HTMLä¸­è®¾ç½®äº†å…¨å±€å˜é‡ï¼Œä¼˜å…ˆä½¿ç”¨
            if (typeof window.API_BASE_URL !== 'undefined') {
                return window.API_BASE_URL;
            }
            
            // æ ¹æ®å½“å‰é¡µé¢çš„åŸŸåå’Œç«¯å£è‡ªåŠ¨åˆ¤æ–­
            const hostname = window.location.hostname;
            const port = window.location.port;
            
            // å¦‚æœWebé¡µé¢åœ¨8080ç«¯å£ï¼ŒAPIæœåŠ¡å™¨é€šå¸¸åœ¨3000ç«¯å£
            if (port === '8080') {
                return `http://${hostname}:3000`;
            }
            
            // é»˜è®¤ä½¿ç”¨3000ç«¯å£
            return `http://${hostname}:3000`;
        }
        
        const API_BASE = getApiBase();
        console.log('APIåŸºç¡€è·¯å¾„:', API_BASE);
        
        // ==================== åº”ç”¨ä»£ç  ====================
        let currentConfig = null, statusData = {}, tokens = [], countdowns = {}, expandedAccount = null;
        let autoLogInterval = null, autoHangupInterval = null, isAutoLog = false, isAutoHangup = false;
        
        // é¡µé¢åˆ‡æ¢
        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            document.getElementById('page-' + page).classList.add('active');
            event.target.classList.add('active');
            
            if (page === 'status') loadStatusData();
            else if (page === 'bin') loadBinFiles();
            else if (page === 'logs') loadLogs();
            else if (page === 'hangup') loadHangupData();
        }
        
        // æ´»åŠ¨å‘¨è®¡ç®—
        const æ´»åŠ¨ç±»å‹ = { 0: 'é»‘å¸‚å‘¨', 1: 'æ‹›å‹Ÿå‘¨', 2: 'å®ç®±å‘¨' };
        const åŸºå‡†æ—¶é—´ = new Date('2025-11-21 12:00:00').getTime();
        function è®¡ç®—æ´»åŠ¨å‘¨å¼€å§‹æ—¶é—´(now) {
            const d = new Date(now), w = d.getDay();
            const fri = new Date(d); fri.setDate(d.getDate() + (w < 5 ? 5 - w : w === 5 ? 0 : 12 - w));
            fri.setHours(12, 0, 0, 0);
            if (d.getTime() < fri.getTime()) fri.setDate(fri.getDate() - 7);
            return fri.getTime();
        }
        function è·å–å½“å‰æ´»åŠ¨å‘¨ç±»å‹() {
            const start = è®¡ç®—æ´»åŠ¨å‘¨å¼€å§‹æ—¶é—´(new Date());
            const idx = Math.floor((start - åŸºå‡†æ—¶é—´) / 604800000) % 3;
            return æ´»åŠ¨ç±»å‹[idx >= 0 ? idx : idx + 3];
        }
        function formatShortTime(s) { 
            if (!s || s <= 0) return '-'; 
            const h = Math.floor(s/3600), m = Math.floor((s%3600)/60), sec = s % 60; 
            if (h > 0) return `${h}å°æ—¶${m}åˆ†${sec}ç§’`;
            if (m > 0) return `${m}åˆ†${sec}ç§’`;
            return `${sec}ç§’`;
        }
        
        // è´¦å·çŠ¶æ€é¡µ
        async function loadStatusData() {
            try {
                const t = Date.now();
                try { await fetch(`${API_BASE}/api/sync-accounts`, { method: 'POST' }); } catch(e) {}
                const tokensRes = await fetch(`/data/tokens.json?t=${t}`);
                if (!tokensRes.ok) throw new Error('æœªæ‰¾åˆ°tokens.json');
                tokens = await tokensRes.json();
                try { const r = await fetch(`/data/account-status.json?t=${t}`); if (r.ok) statusData = await r.json(); } catch(e) {}
                try { const r = await fetch(`/data/task-config.json?t=${t}`); if (r.ok) { 
                    const fullConfig = await r.json(); 
                    currentConfig = fullConfig.è´¦å·é…ç½® || {}; 
                    console.log('é…ç½®åŠ è½½å®Œæˆ:', currentConfig);
                } } catch(e) { console.warn('é…ç½®åŠ è½½å¤±è´¥:', e); }
                
                // åŠ è½½ä»»åŠ¡è°ƒåº¦è®°å½•ï¼Œç”¨äºä¿®æ­£çŠ¶æ€æ˜¾ç¤º
                let scheduleData = {};
                try { 
                    const r = await fetch(`/data/task-schedule-record.json?t=${t}`); 
                    if (r.ok) scheduleData = await r.json(); 
                } catch(e) {}
                
                // ä¿®æ­£BOSSæˆ˜æ–—çŠ¶æ€ï¼ˆä»è°ƒåº¦è®°å½•ä¸­è·å–çœŸå®çŠ¶æ€ï¼‰
                if (scheduleData.BOSSæˆ˜æ–—?.accounts) {
                    Object.keys(statusData).forEach(accountName => {
                        const scheduleRecord = scheduleData.BOSSæˆ˜æ–—.accounts[accountName];
                        if (scheduleRecord && scheduleRecord.lastStatus === 'success') {
                            if (!statusData[accountName].BOSSæˆ˜æ–—) {
                                statusData[accountName].BOSSæˆ˜æ–— = {};
                            }
                            statusData[accountName].BOSSæˆ˜æ–—.çŠ¶æ€ = 'success';
                            statusData[accountName].BOSSæˆ˜æ–—.æœ€åæ‰§è¡Œæ—¶é—´ = scheduleRecord.lastExecutionTime;
                        }
                    });
                }
                
                // æ¸…ç†æ‰€æœ‰ç°æœ‰çš„å€’è®¡æ—¶å®šæ—¶å™¨
                Object.keys(countdowns).forEach(k => { 
                    if (countdowns[k]) {
                        clearInterval(countdowns[k]); 
                        delete countdowns[k];
                    }
                }); 
                countdowns = {};
                
                renderStatusTable();
                document.getElementById('totalAccounts').textContent = tokens.length;
                document.getElementById('withStatus').textContent = Object.keys(statusData).length;
            } catch (e) { 
                document.getElementById('statusTableBody').innerHTML = `<tr><td colspan="6"><div class="no-data"><div class="no-data-icon">âŒ</div><div class="no-data-text">${e.message}</div></div></td></tr>`; 
            }
        }
        
        function renderStatusTable() {
            const tbody = document.getElementById('statusTableBody');
            if (!tokens.length) { 
                tbody.innerHTML = `<tr><td colspan="6"><div class="no-data"><div class="no-data-icon">ğŸ“­</div><div class="no-data-text">æš‚æ— è´¦å·</div></div></td></tr>`; 
                return; 
            }
            let html = '';
            tokens.forEach(t => { 
                html += renderAccountRow(t.name, statusData[t.name]); 
                html += renderDetailRow(t.name, statusData[t.name]);
                html += renderConfigRow(t.name); 
            });
            tbody.innerHTML = html;
            tokens.forEach(t => { if (statusData[t.name]) startCountdown(t.name, statusData[t.name]); });
            if (expandedAccount) { 
                const dr = document.getElementById(`detail-row-${expandedAccount}`);
                const cr = document.getElementById(`config-row-${expandedAccount}`);
                const row = document.getElementById(`data-row-${expandedAccount}`);
                if (dr) dr.classList.add('show'); 
                if (cr) cr.classList.add('show'); 
                if (row) row.classList.add('expanded');
            }
        }
        
        function renderAccountRow(name, status) {
            const now = Date.now() / 1000;
            const dp = status?.dailyTask?.dailyPoint || 0;
            const percentage = Math.min(100, (dp / 110) * 100);
            let progressClass = 'low';
            if (percentage >= 100) progressClass = 'complete';
            else if (percentage >= 70) progressClass = 'high';
            else if (percentage >= 40) progressClass = 'medium';
            
            const dailyCell = `<div class="progress-container">
                <div class="progress-bar ${progressClass}" style="width: ${percentage}%"></div>
                <div class="progress-text">${dp}/110</div>
            </div>`;
            
            // ç›ç½çŠ¶æ€ - æ˜¾ç¤ºå‰©ä½™æ—¶é—´ï¼ˆå€’è®¡æ—¶ï¼‰
            const bottleHelper = status?.bottleHelper;
            let bottleCell = '<span class="badge gray">æœªå¯åŠ¨</span>';
            if (bottleHelper) {
                const hst = bottleHelper.helperStopTime || 0;
                const isRunning = bottleHelper.isRunning || (hst > now);
                if (isRunning && hst > now) {
                    const remaining = Math.max(0, Math.floor(hst - now));
                    bottleCell = `<span class="time-cell">ğŸŸ¢å‰©ä½™<span id="bottle-${name}">${formatShortTime(remaining)}</span></span>`;
                } else {
                    bottleCell = '<span class="badge gray">å·²åœæ­¢</span>';
                }
            }
            
            // æŒ‚æœºçŠ¶æ€ - æ˜¾ç¤ºå·²æŒ‚æœºæ—¶é•¿ï¼ˆæ­£è®¡æ—¶ï¼‰
            const hangUp = status?.hangUp;
            let hangUpCell = '<span class="badge gray">æœªæŒ‚æœº</span>';
            if (hangUp) {
                const lastTime = hangUp.lastTime || 0;
                const hangUpTime = hangUp.hangUpTime || 0;
                if (lastTime > 0) {
                    const elapsedTime = Math.floor(now - lastTime);
                    if (hangUpTime > 0) {
                        const remainingTime = Math.max(0, Math.floor(hangUpTime - (now - lastTime)));
                        if (remainingTime > 0) {
                            // è¿˜åœ¨æŒ‚æœºä¸­ï¼Œæ˜¾ç¤ºå·²æŒ‚æœºæ—¶é•¿
                            hangUpCell = `<span class="time-cell">ğŸŸ¢å·²æŒ‚<span id="hangup-${name}">${formatShortTime(elapsedTime)}</span></span>`;
                        } else {
                            // æŒ‚æœºå·²å®Œæˆ
                            hangUpCell = '<span class="badge warning">å·²å®Œæˆ</span>';
                        }
                    } else {
                        // æ— é™æŒ‚æœºï¼Œæ˜¾ç¤ºå·²æŒ‚æœºæ—¶é•¿
                        hangUpCell = `<span class="time-cell">ğŸŸ¢å·²æŒ‚<span id="hangup-${name}">${formatShortTime(elapsedTime)}</span></span>`;
                    }
                } else {
                    hangUpCell = '<span class="badge gray">æœªæŒ‚æœº</span>';
                }
            }
            
            const as = status?.arena?.status || 'pending', asc = status?.arena?.successCount || 0;
            let arenaBadge = '<span class="badge gray">-</span>';
            if (as === 'success') arenaBadge = `<span class="badge success">${asc}/3âœ“</span>`;
            else if (as === 'partial') arenaBadge = `<span class="badge warning">${asc}/3</span>`;
            else if (as === 'failed') arenaBadge = `<span class="badge danger">${asc}/3</span>`;
            
            return `<tr id="data-row-${name}" class="${expandedAccount===name?'expanded':''}">
                <td class="account-name-cell" onclick="toggleDetail('${name}')">
                    <span class="expand-icon ${expandedAccount===name?'open':''}">â–¶</span>${name}
                </td>
                <td>${dailyCell}</td>
                <td>${bottleCell}</td>
                <td>${hangUpCell}</td>
                <td>${arenaBadge}</td>
                <td>
                    <button class="action-btn settings" onclick="toggleConfig('${name}')">âš™ï¸</button>
                    <button class="action-btn" onclick="openTools('${name}')" title="å·¥å…·ç®±">ğŸ§°</button>
                </td>
            </tr>`;
        }
        
        function renderDetailRow(name, status) {
            if (!status) {
                return `<tr id="detail-row-${name}" class="detail-row ${expandedAccount===name?'show':''}">
                    <td colspan="6">
                        <div class="detail-panel">
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <div class="detail-item-label">ç­¾åˆ°</div>
                                    <div class="detail-item-value"><span class="badge gray">æ— æ•°æ®</span></div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-item-label">å’¸å°†å¡”</div>
                                    <div class="detail-item-value"><span class="badge gray">æ— æ•°æ®</span></div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-item-label">ç­”é¢˜</div>
                                    <div class="detail-item-value"><span class="badge gray">æ— æ•°æ®</span></div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-item-label">èµ›è½¦</div>
                                    <div class="detail-item-value"><span class="badge gray">æ— æ•°æ®</span></div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-item-label">ç«æŠ€åœº</div>
                                    <div class="detail-item-value"><span class="badge gray">æ— æ•°æ®</span></div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-item-label">å››åœ£ç¢ç‰‡</div>
                                    <div class="detail-item-value"><span class="badge gray">æ— æ•°æ®</span></div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-item-label">æ¯æ—¥å’¸ç‹</div>
                                    <div class="detail-item-value"><span class="badge gray">æ— æ•°æ®</span></div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-item-label">ç¯ç¥</div>
                                    <div class="detail-item-value"><span class="badge gray">æ— æ•°æ®</span></div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-item-label">BOSSæˆ˜æ–—</div>
                                    <div class="detail-item-value"><span class="badge gray">æ— æ•°æ®</span></div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-item-label">æ¢¦å¢ƒ</div>
                                    <div class="detail-item-value"><span class="badge gray">æ— æ•°æ®</span></div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-item-label">å®åº“</div>
                                    <div class="detail-item-value">${(() => {
                                        const ä»Šå¤©å‘¨å‡  = new Date().getDay();
                                        return (ä»Šå¤©å‘¨å‡  === 1 || ä»Šå¤©å‘¨å‡  === 2) 
                                            ? '<span class="badge gray">éå¼€æ”¾</span>' 
                                            : '<span class="badge gray">æœªå¼€å¯</span>';
                                    })()}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-item-label">æ´»åŠ¨å‘¨</div>
                                    <div class="detail-item-value"><span class="badge gray">æ— æ•°æ®</span></div>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>`;
            }
            
            // ç­¾åˆ°çŠ¶æ€ - è¯¦ç»†ä¿¡æ¯
            const signinBadge = status.signin?.isSignedIn ? 
                '<span class="badge success">âœ“å·²ç­¾åˆ°</span>' : 
                '<span class="badge gray">æœªç­¾åˆ°</span>';
            
            // ä¿±ä¹éƒ¨ç­¾åˆ°çŠ¶æ€
            const clubSigninBadge = status.clubSignin?.isSignedIn ? 
                '<span class="badge success">âœ“å·²ç­¾åˆ°</span>' : 
                '<span class="badge gray">æœªç­¾åˆ°</span>';
            
            // æŒ‚æœºå¥–åŠ±çŠ¶æ€
            const hangupRewardBadge = status.hangupReward?.isCollected ? 
                '<span class="badge success">âœ“å·²é¢†å–</span>' : 
                '<span class="badge gray">æœªé¢†å–</span>';
            
            // å’¸é±¼å¤§å†²å…³çŠ¶æ€
            const rushBadge = status.rush?.isCompleted ? 
                '<span class="badge success">âœ“å·²å®Œæˆ</span>' : 
                '<span class="badge gray">æœªå®Œæˆ</span>';
            
            // å’¸å°†å¡”çŠ¶æ€ - è¯¦ç»†æˆ˜æ–—ä¿¡æ¯
            const tower = status.tower;
            let towerBadge = '<span class="badge gray">æœªæŒ‘æˆ˜</span>';
            if (tower) {
                const tc = tower.today?.challengeCount || 0;
                const sc = tower.today?.successCount || 0;
                const fc = tower.today?.failCount || 0;
                const towerId = tower.towerId || 0;
                
                // æ ¼å¼åŒ–å±‚æ•°ï¼štowerIdè½¬æ¢ä¸ºå±‚æ•°-å…³å¡æ ¼å¼
                let currentFloor = '-';
                if (towerId > 0) {
                    const å±‚æ•° = Math.floor(towerId / 10) + 1;
                    const å…³å¡ = towerId % 10;
                    currentFloor = `${å±‚æ•°}-${å…³å¡}`;
                }
                
                if (tc > 0) {
                    const successRate = tc > 0 ? Math.round((sc / tc) * 100) : 0;
                    towerBadge = `<span class="badge info">${currentFloor}å±‚<br/>${tc}æˆ˜${sc}èƒœ${fc}è´¥(${successRate}%)</span>`;
                } else if (towerId > 0) {
                    towerBadge = `<span class="badge info">${currentFloor}å±‚<br/>(ä»Šæ—¥æœªæŒ‘æˆ˜)</span>`;
                }
            }
            
            // ç­”é¢˜çŠ¶æ€ - è¯¦ç»†åˆ†æ•°ä¿¡æ¯
            const study = status.study;
            let studyBadge = '<span class="badge gray">æœªç­”é¢˜</span>';
            if (study?.hasAnswered) {
                const score = study.score || 0;
                const maxScore = study.maxCorrectNum || 0;
                studyBadge = `<span class="badge success">${score}åˆ†<br/>(æœ€é«˜${maxScore}é¢˜)</span>`;
            }
            
            // èµ›è½¦çŠ¶æ€ - è¯¦ç»†å‚ä¸ä¿¡æ¯
            const carKing = status.carKing;
            let carBadge = '<span class="badge gray">æœªå‚ä¸</span>';
            if (carKing?.hasPlayed) {
                const cd = carKing.å·²æ‰§è¡Œæ—¥æœŸ || [];
                const totalDays = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰'];
                const completedDays = cd.length;
                const isComplete = totalDays.every(day => cd.includes(day));
                
                if (isComplete) {
                    carBadge = '<span class="badge success">âœ“å…¨å‘¨å®Œæˆ<br/>(3/3å¤©)</span>';
                } else if (completedDays > 0) {
                    carBadge = `<span class="badge warning">éƒ¨åˆ†å®Œæˆ<br/>(${completedDays}/3å¤©)</span>`;
                }
            }
            
            // å››åœ£ç¢ç‰‡çŠ¶æ€ - è¯¦ç»†è´­ä¹°ä¿¡æ¯
            const legion = status.legionShop;
            let legionBadge = '<span class="badge gray">æœªè´­ä¹°</span>';
            if (legion) {
                const state = legion.æ˜¾ç¤ºçŠ¶æ€ || legion.çŠ¶æ€ || '';
                const buyDate = legion.è´­ä¹°æ—¥æœŸ;
                const error = legion.é”™è¯¯ä¿¡æ¯;
                
                if (state === 'purchased') {
                    const dateStr = buyDate ? new Date(buyDate).toLocaleDateString('zh-CN', {month:'numeric',day:'numeric'}) : '';
                    legionBadge = `<span class="badge success">âœ“å·²è´­ä¹°<br/>${dateStr}</span>`;
                } else if (state === 'insufficient') {
                    legionBadge = '<span class="badge warning">ç¢ç‰‡ä¸è¶³</span>';
                } else if (state === 'failed') {
                    legionBadge = `<span class="badge danger">è´­ä¹°å¤±è´¥</span>`;
                } else if (state === 'pending') {
                    legionBadge = '<span class="badge info">å¾…è´­ä¹°</span>';
                }
            }
            
            // æ¯æ—¥å’¸ç‹çŠ¶æ€ - è¯¦ç»†æ‰§è¡Œä¿¡æ¯
            const king = status.æ¯æ—¥å’¸ç‹;
            let kingBadge = '<span class="badge gray">æœªå‚ä¸</span>';
            if (king) {
                const state = king.çŠ¶æ€ || '';
                const execCount = king.æ‰§è¡Œæ¬¡æ•° || 0;
                const successCount = king.æˆåŠŸæ¬¡æ•° || 0;
                const lastTime = king.æœ€åæ‰§è¡Œæ—¶é—´;
                const error = king.é”™è¯¯ä¿¡æ¯;
                
                if (state === 'success') {
                    kingBadge = `<span class="badge success">âœ“å®Œæˆ<br/>(${successCount}/${execCount}æ¬¡)</span>`;
                } else if (state === 'failed') {
                    const errorMsg = error ? `<br/>(${error.substring(0, 10)}...)` : '';
                    kingBadge = `<span class="badge danger">å¤±è´¥<br/>(${successCount}/${execCount}æ¬¡)${errorMsg}</span>`;
                } else if (state === 'pending') {
                    kingBadge = '<span class="badge info">å¾…æ‰§è¡Œ</span>';
                }
            }
            
            // ç¯ç¥çŠ¶æ€
            const genie = status.ç¯ç¥;
            let genieBadge = '<span class="badge gray">æœªå‚ä¸</span>';
            if (genie) {
                const state = genie.çŠ¶æ€ || '';
                const lastTime = genie.æœ€åæ‰§è¡Œæ—¶é—´;
                
                if (state === 'success') {
                    genieBadge = '<span class="badge success">âœ“å®Œæˆ</span>';
                } else if (state === 'failed') {
                    genieBadge = '<span class="badge danger">å¤±è´¥</span>';
                } else if (state === 'pending') {
                    genieBadge = '<span class="badge info">å¾…æ‰§è¡Œ</span>';
                }
            }
            
            // BOSSæˆ˜æ–—çŠ¶æ€
            const boss = status.BOSSæˆ˜æ–—;
            let bossBadge = '<span class="badge gray">æœªå‚ä¸</span>';
            if (boss) {
                const state = boss.çŠ¶æ€ || '';
                const lastTime = boss.æœ€åæ‰§è¡Œæ—¶é—´;
                
                if (state === 'success') {
                    bossBadge = '<span class="badge success">âœ“å®Œæˆ</span>';
                } else if (state === 'failed') {
                    bossBadge = '<span class="badge danger">å¤±è´¥</span>';
                } else if (state === 'pending') {
                    bossBadge = '<span class="badge info">å¾…æ‰§è¡Œ</span>';
                }
            }
            
            // æ¢¦å¢ƒçŠ¶æ€
            const dream = status.æ¢¦å¢ƒ;
            let dreamBadge = '<span class="badge gray">æœªå‚ä¸</span>';
            if (dream) {
                const state = dream.çŠ¶æ€ || '';
                const lastTime = dream.æœ€åæ‰§è¡Œæ—¶é—´;
                
                if (state === 'success') {
                    dreamBadge = '<span class="badge success">âœ“å®Œæˆ</span>';
                } else if (state === 'failed') {
                    dreamBadge = '<span class="badge danger">å¤±è´¥</span>';
                } else if (state === 'pending') {
                    dreamBadge = '<span class="badge info">å¾…æ‰§è¡Œ</span>';
                }
            }
            
            // å®åº“çŠ¶æ€ï¼ˆå‘¨ä»»åŠ¡ï¼Œå‘¨ä¸‰è‡³å‘¨æ—¥å¼€æ”¾ï¼‰
            const baoku = status.å®åº“;
            let baokuBadge = '';
            const ä»Šå¤©å‘¨å‡  = new Date().getDay();
            const æ˜¯å®åº“å¼€æ”¾æ—¥ = (ä»Šå¤©å‘¨å‡  !== 1 && ä»Šå¤©å‘¨å‡  !== 2);
            
            if (!æ˜¯å®åº“å¼€æ”¾æ—¥) {
                baokuBadge = '<span class="badge gray">éå¼€æ”¾</span>';
            } else if (!baoku || !baoku.æœ€åæ‰§è¡Œæ—¶é—´) {
                // æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å¯ç”¨
                const baokuConfig = currentConfig?.[name]?.å®åº“;
                if (!baokuConfig?.å¯ç”¨) {
                    baokuBadge = '<span class="badge gray">æœªå¼€å¯</span>';
                } else {
                    baokuBadge = '<span class="badge info">æœªæ‰§è¡Œ</span>';
                }
            } else {
                // æ£€æŸ¥æ˜¯å¦æœ¬å‘¨å·²æ‰§è¡Œï¼ˆä»å‘¨ä¸‰å¼€å§‹ç®—ï¼‰
                const lastTime = new Date(baoku.æœ€åæ‰§è¡Œæ—¶é—´);
                const now = new Date();
                const æœ¬å‘¨ä¸‰ = new Date(now);
                æœ¬å‘¨ä¸‰.setHours(0, 0, 0, 0);
                const è·ç¦»å‘¨ä¸‰å¤©æ•° = ä»Šå¤©å‘¨å‡  >= 3 ? ä»Šå¤©å‘¨å‡  - 3 : ä»Šå¤©å‘¨å‡  + 4;
                æœ¬å‘¨ä¸‰.setDate(now.getDate() - è·ç¦»å‘¨ä¸‰å¤©æ•°);
                
                if (lastTime >= æœ¬å‘¨ä¸‰) {
                    baokuBadge = '<span class="badge success">âœ“å·²æ‰§è¡Œ</span>';
                } else {
                    const baokuConfig = currentConfig?.[name]?.å®åº“;
                    if (!baokuConfig?.å¯ç”¨) {
                        baokuBadge = '<span class="badge gray">æœªå¼€å¯</span>';
                    } else {
                        baokuBadge = '<span class="badge info">æœªæ‰§è¡Œ</span>';
                    }
                }
            }
            
            // é’“é±¼æœˆåº¦è¿›åº¦
            const fishMonthConfig = currentConfig?.[name]?.æ¯æ—¥ä»»åŠ¡?.é’“é±¼æœˆåº¦è¡¥é½;
            let fishMonthBadge = '';
            if (fishMonthConfig === true) {
                const fishMonth = status.é’“é±¼æœˆåº¦;
                if (fishMonth?.å½“å‰è¿›åº¦ !== undefined) {
                    const progress = fishMonth.å½“å‰è¿›åº¦;
                    const target = fishMonth.ç›®æ ‡è¿›åº¦ || 320;
                    const shouldBe = fishMonth.åº”è¾¾è¿›åº¦ || 0;
                    const percent = Math.round((progress / target) * 100);
                    if (progress >= shouldBe) {
                        fishMonthBadge = `<span class="badge success">âœ“${progress}/${target}</span>`;
                    } else {
                        fishMonthBadge = `<span class="badge warning">${progress}/${target} (${percent}%)</span>`;
                    }
                } else {
                    fishMonthBadge = '<span class="badge info">å¾…æ£€æµ‹</span>';
                }
            } else {
                fishMonthBadge = '<span class="badge gray">æœªå¼€å¯</span>';
            }
            
            // ç«æŠ€åœºæœˆåº¦è¿›åº¦
            const arenaMonthConfig = currentConfig?.[name]?.ç«æŠ€åœº?.æœˆåº¦è¡¥é½;
            let arenaMonthBadge = '';
            if (arenaMonthConfig === true) {
                const arenaMonth = status.arena;
                if (arenaMonth?.æœˆåº¦è¿›åº¦ !== undefined) {
                    const progress = arenaMonth.æœˆåº¦è¿›åº¦;
                    const target = arenaMonth.æœˆåº¦ç›®æ ‡ || 240;
                    const shouldBe = arenaMonth.æœˆåº¦åº”è¾¾ || 0;
                    const percent = Math.round((progress / target) * 100);
                    if (progress >= shouldBe) {
                        arenaMonthBadge = `<span class="badge success">âœ“${progress}/${target}</span>`;
                    } else {
                        arenaMonthBadge = `<span class="badge warning">${progress}/${target} (${percent}%)</span>`;
                    }
                } else {
                    arenaMonthBadge = '<span class="badge info">å¾…æ£€æµ‹</span>';
                }
            } else {
                arenaMonthBadge = '<span class="badge gray">æœªå¼€å¯</span>';
            }
            
            // ç«æŠ€åœºçŠ¶æ€ - è¯¦ç»†æˆ˜æ–—ä¿¡æ¯
            const arena = status.arena;
            let arenaBadge = '<span class="badge gray">æœªå‚ä¸</span>';
            if (arena) {
                const successCount = arena.successCount || 0;
                const attemptCount = arena.attemptCount || 0;
                const arenaStatus = arena.status || 'pending';
                const lastTime = arena.lastExecuteTime;
                
                if (arenaStatus === 'success') {
                    arenaBadge = `<span class="badge success">âœ“å®Œæˆ<br/>(${successCount}/3èƒœ)</span>`;
                } else if (arenaStatus === 'partial') {
                    arenaBadge = `<span class="badge warning">è¿›è¡Œä¸­<br/>(${successCount}/3èƒœ)</span>`;
                } else if (arenaStatus === 'failed') {
                    arenaBadge = `<span class="badge danger">å¤±è´¥<br/>(${successCount}/3èƒœ)</span>`;
                } else if (arenaStatus === 'pending') {
                    arenaBadge = '<span class="badge info">å¾…æ‰§è¡Œ</span>';
                }
            }
            
            // æ´»åŠ¨å‘¨çŠ¶æ€ - è¯¦ç»†æ´»åŠ¨ä¿¡æ¯
            const awt = è·å–å½“å‰æ´»åŠ¨å‘¨ç±»å‹();
            let actBadge = '<span class="badge gray">æœªå‚ä¸</span>';
            if (awt === 'é»‘å¸‚å‘¨') {
                const bm = status.blackMarketWeek;
                if (bm?.è´­ä¹°æ—¥æœŸ) {
                    const buyTime = new Date(bm.è´­ä¹°æ—¥æœŸ);
                    const weekStart = è®¡ç®—æ´»åŠ¨å‘¨å¼€å§‹æ—¶é—´(new Date());
                    if (buyTime.getTime() >= weekStart) {
                        actBadge = `<span class="badge success">âœ“å·²è´­ä¹° ${buyTime.toLocaleDateString()}</span>`;
                    } else {
                        actBadge = '<span class="badge warning">æœ¬å‘¨æœªè´­ä¹°</span>';
                    }
                } else {
                    actBadge = '<span class="badge warning">å¾…è´­ä¹°</span>';
                }
            } else if (awt === 'æ‹›å‹Ÿå‘¨') {
                actBadge = '<span class="badge info">æ‹›å‹Ÿå‘¨ (æš‚æ— æ•°æ®)</span>';
            } else if (awt === 'å®ç®±å‘¨') {
                actBadge = '<span class="badge info">å®ç®±å‘¨ (æš‚æ— æ•°æ®)</span>';
            }
            
            return `<tr id="detail-row-${name}" class="detail-row ${expandedAccount===name?'show':''}">
                <td colspan="6">
                    <div class="detail-panel">
                        <div class="detail-grid">
                            <div class="detail-item">
                                <div class="detail-item-label">ç­¾åˆ°</div>
                                <div class="detail-item-value">${signinBadge}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-item-label">å’¸å°†å¡”</div>
                                <div class="detail-item-value">${towerBadge}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-item-label">ç­”é¢˜</div>
                                <div class="detail-item-value">${studyBadge}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-item-label">æŒ‚æœºå¥–åŠ±</div>
                                <div class="detail-item-value">${hangupRewardBadge}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-item-label">èµ›è½¦</div>
                                <div class="detail-item-value">${carBadge}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-item-label">å’¸é±¼å¤§å†²å…³</div>
                                <div class="detail-item-value">${rushBadge}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-item-label">ç«æŠ€åœº</div>
                                <div class="detail-item-value">${arenaBadge}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-item-label">å››åœ£ç¢ç‰‡</div>
                                <div class="detail-item-value">${legionBadge}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-item-label">æ¯æ—¥å’¸ç‹</div>
                                <div class="detail-item-value">${kingBadge}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-item-label">ç¯ç¥</div>
                                <div class="detail-item-value">${genieBadge}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-item-label">BOSSæˆ˜æ–—</div>
                                <div class="detail-item-value">${bossBadge}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-item-label">æ¢¦å¢ƒ</div>
                                <div class="detail-item-value">${dreamBadge}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-item-label">å®åº“</div>
                                <div class="detail-item-value">${baokuBadge}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-item-label">ğŸ£é’“é±¼æœˆåº¦</div>
                                <div class="detail-item-value">${fishMonthBadge}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-item-label">âš”ï¸ç«æŠ€åœºæœˆåº¦</div>
                                <div class="detail-item-value">${arenaMonthBadge}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-item-label">${awt}</div>
                                <div class="detail-item-value">${actBadge}</div>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>`;
        }
        
        function renderConfigRow(name) {
            const config = currentConfig?.[name] || {};
            return `<tr id="config-row-${name}" class="config-row">
                <td colspan="6">
                    <div class="config-panel">
                        <div class="config-panel-header">
                            <div class="config-panel-title">âš™ï¸ ${name} - ä»»åŠ¡é…ç½®</div>
                            <div class="config-panel-actions">
                                <button class="btn secondary" onclick="toggleConfig('${name}')">âœ•</button>
                            </div>
                        </div>
                        
                        <!-- è´¦å·æ€»å¼€å…³ -->
                        <div class="config-row-group">
                            <div class="config-row-title">ğŸ¯ è´¦å·æ€»å¼€å…³</div>
                            <div class="config-row-items">
                                <div class="config-inline-item">
                                    <span class="label">å¯ç”¨:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.å¯ç”¨ !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'å¯ç”¨', null, this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- æ¯æ—¥ä»»åŠ¡ç»„ -->
                        <div class="config-row-group">
                            <div class="config-row-title">ğŸ“‹ æ¯æ—¥ä»»åŠ¡</div>
                            <div class="config-row-items">
                                <div class="config-inline-item">
                                    <span class="label">æ¯æ—¥ä»»åŠ¡:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.æ¯æ—¥ä»»åŠ¡?.å¯ç”¨ !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¯æ—¥ä»»åŠ¡', 'å¯ç”¨', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- æ¯æ—¥ä»»åŠ¡å­é€‰é¡¹ -->
                        <div class="simple-tasks-row">
                            <div class="simple-task-item">
                                <span class="simple-task-label">ä»˜è´¹æ‹›å‹Ÿ:</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" ${config.æ¯æ—¥ä»»åŠ¡?.ä»˜è´¹æ‹›å‹Ÿ !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¯æ—¥ä»»åŠ¡', 'ä»˜è´¹æ‹›å‹Ÿ', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="simple-task-item">
                                <span class="simple-task-label">é¢†å–æŒ‚æœºå¥–åŠ±:</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" ${config.æ¯æ—¥ä»»åŠ¡?.é¢†å–æŒ‚æœºå¥–åŠ± !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¯æ—¥ä»»åŠ¡', 'é¢†å–æŒ‚æœºå¥–åŠ±', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="simple-task-item">
                                <span class="simple-task-label">å¼€å¯å®ç®±:</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" ${config.æ¯æ—¥ä»»åŠ¡?.å¼€å¯å®ç®± !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¯æ—¥ä»»åŠ¡', 'å¼€å¯å®ç®±', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="simple-task-item">
                                <span class="simple-task-label">é¢†å–ç›ç½:</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" ${config.æ¯æ—¥ä»»åŠ¡?.é¢†å–ç›ç½ !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¯æ—¥ä»»åŠ¡', 'é¢†å–ç›ç½', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="simple-task-item">
                                <span class="simple-task-label">é¢†å–é‚®ä»¶:</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" ${config.æ¯æ—¥ä»»åŠ¡?.é¢†å–é‚®ä»¶ !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¯æ—¥ä»»åŠ¡', 'é¢†å–é‚®ä»¶', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="simple-task-item">
                                <span class="simple-task-label">é»‘å¸‚è´­ä¹°:</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" ${config.æ¯æ—¥ä»»åŠ¡?.é»‘å¸‚è´­ä¹° !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¯æ—¥ä»»åŠ¡', 'é»‘å¸‚è´­ä¹°', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="simple-task-item">
                                <span class="simple-task-label">è´­ä¹°æ¸…å•:</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" ${config.æ¯æ—¥ä»»åŠ¡?.è´­ä¹°æ¸…å• !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¯æ—¥ä»»åŠ¡', 'è´­ä¹°æ¸…å•', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="simple-task-item">
                                <span class="simple-task-label">æ‰‹åŠ¨è´­ä¹°:</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" ${config.æ¯æ—¥ä»»åŠ¡?.æ‰‹åŠ¨è´­ä¹° !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¯æ—¥ä»»åŠ¡', 'æ‰‹åŠ¨è´­ä¹°', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="simple-task-item">
                                <span class="simple-task-label">ğŸ£é’“é±¼æœˆåº¦è¡¥é½:</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" ${config.æ¯æ—¥ä»»åŠ¡?.é’“é±¼æœˆåº¦è¡¥é½ === true ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¯æ—¥ä»»åŠ¡', 'é’“é±¼æœˆåº¦è¡¥é½', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>

                        <!-- ç«æŠ€åœºç»„ -->
                        <div class="config-row-group">
                            <div class="config-row-title">âš”ï¸ ç«æŠ€åœº</div>
                            <div class="config-row-items">
                                <div class="config-inline-item">
                                    <span class="label">ç«æŠ€åœº:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.ç«æŠ€åœº?.å¯ç”¨ !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'ç«æŠ€åœº', 'å¯ç”¨', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="config-inline-item">
                                    <span class="label">æœˆåº¦è¡¥é½:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.ç«æŠ€åœº?.æœˆåº¦è¡¥é½ === true ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'ç«æŠ€åœº', 'æœˆåº¦è¡¥é½', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="config-inline-item">
                                    <span class="label">ç«æŠ€åœºé˜µå®¹:</span>
                                    <div class="number-input-group">
                                        <button class="number-btn decrease" onclick="adjustNestedNumber('${name}', 'ç«æŠ€åœº', 'ç«æŠ€åœºé˜µå®¹', -1)">-</button>
                                        <input type="number" value="${config.ç«æŠ€åœº?.ç«æŠ€åœºé˜µå®¹ || 1}" min="1" max="5" onchange="updateNestedConfig('${name}', 'ç«æŠ€åœº', 'ç«æŠ€åœºé˜µå®¹', parseInt(this.value))">
                                        <button class="number-btn increase" onclick="adjustNestedNumber('${name}', 'ç«æŠ€åœº', 'ç«æŠ€åœºé˜µå®¹', 1)">+</button>
                                    </div>
                                </div>
                                <div class="config-inline-item">
                                    <span class="label">æˆ˜æ–—æ¬¡æ•°:</span>
                                    <div class="number-input-group">
                                        <button class="number-btn decrease" onclick="adjustNestedNumber('${name}', 'ç«æŠ€åœº', 'æˆ˜æ–—æ¬¡æ•°', -1)">-</button>
                                        <input type="number" value="${config.ç«æŠ€åœº?.æˆ˜æ–—æ¬¡æ•° || 3}" min="1" max="10" onchange="updateNestedConfig('${name}', 'ç«æŠ€åœº', 'æˆ˜æ–—æ¬¡æ•°', parseInt(this.value))">
                                        <button class="number-btn increase" onclick="adjustNestedNumber('${name}', 'ç«æŠ€åœº', 'æˆ˜æ–—æ¬¡æ•°', 1)">+</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- BOSSæˆ˜æ–—ç»„ -->
                        <div class="config-row-group">
                            <div class="config-row-title">ğŸ‘¹ BOSSæˆ˜æ–—</div>
                            <div class="config-row-items">
                                <div class="config-inline-item">
                                    <span class="label">BOSSæˆ˜æ–—:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.BOSSæˆ˜æ–—?.å¯ç”¨ !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'BOSSæˆ˜æ–—', 'å¯ç”¨', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="config-inline-item">
                                    <span class="label">BOSSé˜µå®¹:</span>
                                    <div class="number-input-group">
                                        <button class="number-btn decrease" onclick="adjustNestedNumber('${name}', 'BOSSæˆ˜æ–—', 'BOSSé˜µå®¹', -1)">-</button>
                                        <input type="number" value="${config.BOSSæˆ˜æ–—?.BOSSé˜µå®¹ || 1}" min="1" max="5" onchange="updateNestedConfig('${name}', 'BOSSæˆ˜æ–—', 'BOSSé˜µå®¹', parseInt(this.value))">
                                        <button class="number-btn increase" onclick="adjustNestedNumber('${name}', 'BOSSæˆ˜æ–—', 'BOSSé˜µå®¹', 1)">+</button>
                                    </div>
                                </div>
                                <div class="config-inline-item">
                                    <span class="label">æˆ˜æ–—æ¬¡æ•°:</span>
                                    <div class="number-input-group">
                                        <button class="number-btn decrease" onclick="adjustNestedNumber('${name}', 'BOSSæˆ˜æ–—', 'æˆ˜æ–—æ¬¡æ•°', -1)">-</button>
                                        <input type="number" value="${config.BOSSæˆ˜æ–—?.æˆ˜æ–—æ¬¡æ•° || 2}" min="1" max="10" onchange="updateNestedConfig('${name}', 'BOSSæˆ˜æ–—', 'æˆ˜æ–—æ¬¡æ•°', parseInt(this.value))">
                                        <button class="number-btn increase" onclick="adjustNestedNumber('${name}', 'BOSSæˆ˜æ–—', 'æˆ˜æ–—æ¬¡æ•°', 1)">+</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- å…¶ä»–ä»»åŠ¡ç»„ -->
                        <div class="simple-tasks-row">
                            <div class="simple-task-item">
                                <span class="simple-task-label">æŒ‚æœºå¥–åŠ±:</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" ${config.æŒ‚æœºå¥–åŠ±?.å¯ç”¨ !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æŒ‚æœºå¥–åŠ±', 'å¯ç”¨', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="simple-task-item">
                                <span class="simple-task-label">ç›ç½æœºå™¨:</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" ${config.ç›ç½æœºå™¨?.å¯ç”¨ !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'ç›ç½æœºå™¨', 'å¯ç”¨', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="simple-task-item">
                                <span class="simple-task-label">å’¸é±¼å¤§å†²å…³:</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" ${config.å’¸é±¼å¤§å†²å…³?.å¯ç”¨ !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'å’¸é±¼å¤§å†²å…³', 'å¯ç”¨', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="simple-task-item">
                                <span class="simple-task-label">ç–¯ç‹‚èµ›è½¦:</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" ${config.ç–¯ç‹‚èµ›è½¦?.å¯ç”¨ !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'ç–¯ç‹‚èµ›è½¦', 'å¯ç”¨', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="simple-task-item">
                                <span class="simple-task-label">ä¿±ä¹éƒ¨ç­¾åˆ°:</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" ${config.ä¿±ä¹éƒ¨ç­¾åˆ°?.å¯ç”¨ !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'ä¿±ä¹éƒ¨ç­¾åˆ°', 'å¯ç”¨', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="simple-task-item">
                                <span class="simple-task-label">å†›å›¢å•†åº—è´­ä¹°:</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" ${config.å†›å›¢å•†åº—è´­ä¹°?.å¯ç”¨ !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'å†›å›¢å•†åº—è´­ä¹°', 'å¯ç”¨', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="simple-task-item">
                                <span class="simple-task-label">æ¯æ—¥å’¸ç‹:</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" ${config.æ¯æ—¥å’¸ç‹?.å¯ç”¨ !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¯æ—¥å’¸ç‹', 'å¯ç”¨', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="simple-task-item">
                                <span class="simple-task-label">ç¯ç¥:</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" ${config.ç¯ç¥?.å¯ç”¨ !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'ç¯ç¥', 'å¯ç”¨', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>

                        <!-- æ¢¦å¢ƒç»„ -->
                        <div class="config-row-group">
                            <div class="config-row-title">ğŸŒ™ æ¢¦å¢ƒ</div>
                            <div class="config-row-items">
                                <div class="config-inline-item">
                                    <span class="label">æ¢¦å¢ƒ:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.æ¢¦å¢ƒ?.å¯ç”¨ !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¢¦å¢ƒ', 'å¯ç”¨', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="config-inline-item">
                                    <span class="label">æ¢¦å¢ƒé˜µå®¹:</span>
                                    <div class="number-input-group">
                                        <button class="number-btn decrease" onclick="adjustNestedNumber('${name}', 'æ¢¦å¢ƒ', 'æ¢¦å¢ƒé˜µå®¹', -1)">-</button>
                                        <input type="number" value="${config.æ¢¦å¢ƒ?.æ¢¦å¢ƒé˜µå®¹ || 1}" min="1" max="5" onchange="updateNestedConfig('${name}', 'æ¢¦å¢ƒ', 'æ¢¦å¢ƒé˜µå®¹', parseInt(this.value))">
                                        <button class="number-btn increase" onclick="adjustNestedNumber('${name}', 'æ¢¦å¢ƒ', 'æ¢¦å¢ƒé˜µå®¹', 1)">+</button>
                                    </div>
                                </div>
                                <div class="config-inline-item">
                                    <span class="label">è‡ªåŠ¨æˆ˜æ–—:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.æ¢¦å¢ƒ?.è‡ªåŠ¨æˆ˜æ–— !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¢¦å¢ƒ', 'è‡ªåŠ¨æˆ˜æ–—', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                            <!-- åˆçº§å•†äºº -->
                            <div class="config-row-items" style="width:100%; margin-top:6px;">
                                <span class="merchant-tag green">ğŸŸ¢ åˆçº§</span>
                                <div class="config-inline-item">
                                    <span class="label">æŒ‘æˆ˜ç¥¨:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.æ¢¦å¢ƒ?.åˆçº§_æŒ‘æˆ˜ç¥¨ ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¢¦å¢ƒ', 'åˆçº§_æŒ‘æˆ˜ç¥¨', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="config-inline-item">
                                    <span class="label">å’¸ç¥ç«æŠŠ:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.æ¢¦å¢ƒ?.åˆçº§_å’¸ç¥ç«æŠŠ ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¢¦å¢ƒ', 'åˆçº§_å’¸ç¥ç«æŠŠ', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="config-inline-item">
                                    <span class="label">å®ç®±:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.æ¢¦å¢ƒ?.åˆçº§_å®ç®± ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¢¦å¢ƒ', 'åˆçº§_å®ç®±', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                            <!-- ä¸­çº§å•†äºº -->
                            <div class="config-row-items" style="width:100%; margin-top:4px;">
                                <span class="merchant-tag yellow">ğŸŸ¡ ä¸­çº§</span>
                                <div class="config-inline-item">
                                    <span class="label">æ¢¦é­‡æ™¶çŸ³:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.æ¢¦å¢ƒ?.ä¸­çº§_æ¢¦é­‡æ™¶çŸ³ ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¢¦å¢ƒ', 'ä¸­çº§_æ¢¦é­‡æ™¶çŸ³', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="config-inline-item">
                                    <span class="label">é»„é‡‘é±¼ç«¿:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.æ¢¦å¢ƒ?.ä¸­çº§_é»„é‡‘é±¼ç«¿ ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¢¦å¢ƒ', 'ä¸­çº§_é»„é‡‘é±¼ç«¿', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="config-inline-item">
                                    <span class="label">æ‹›å‹Ÿä»¤:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.æ¢¦å¢ƒ?.ä¸­çº§_æ‹›å‹Ÿä»¤ ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¢¦å¢ƒ', 'ä¸­çº§_æ‹›å‹Ÿä»¤', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="config-inline-item">
                                    <span class="label">å®ç®±:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.æ¢¦å¢ƒ?.ä¸­çº§_å®ç®± ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¢¦å¢ƒ', 'ä¸­çº§_å®ç®±', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="config-inline-item">
                                    <span class="label">å°†é­‚ç¢ç‰‡:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.æ¢¦å¢ƒ?.ä¸­çº§_å°†é­‚ç¢ç‰‡ ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¢¦å¢ƒ', 'ä¸­çº§_å°†é­‚ç¢ç‰‡', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                            <!-- é«˜çº§å•†äºº -->
                            <div class="config-row-items" style="width:100%; margin-top:4px;">
                                <span class="merchant-tag red">ğŸ”´ é«˜çº§</span>
                                <div class="config-inline-item">
                                    <span class="label">æ¢¦é­‡æ™¶çŸ³:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.æ¢¦å¢ƒ?.é«˜çº§_æ¢¦é­‡æ™¶çŸ³ ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¢¦å¢ƒ', 'é«˜çº§_æ¢¦é­‡æ™¶çŸ³', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="config-inline-item">
                                    <span class="label">é»„é‡‘é±¼ç«¿:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.æ¢¦å¢ƒ?.é«˜çº§_é»„é‡‘é±¼ç«¿ ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¢¦å¢ƒ', 'é«˜çº§_é»„é‡‘é±¼ç«¿', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="config-inline-item">
                                    <span class="label">æ‹›å‹Ÿä»¤:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.æ¢¦å¢ƒ?.é«˜çº§_æ‹›å‹Ÿä»¤ ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¢¦å¢ƒ', 'é«˜çº§_æ‹›å‹Ÿä»¤', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="config-inline-item">
                                    <span class="label">å®ç®±:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.æ¢¦å¢ƒ?.é«˜çº§_å®ç®± ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¢¦å¢ƒ', 'é«˜çº§_å®ç®±', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="config-inline-item">
                                    <span class="label">å°†é­‚ç¢ç‰‡:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.æ¢¦å¢ƒ?.é«˜çº§_å°†é­‚ç¢ç‰‡ ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'æ¢¦å¢ƒ', 'é«˜çº§_å°†é­‚ç¢ç‰‡', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- é»‘å¸‚å‘¨è´­ä¹°ç»„ -->
                        <div class="config-row-group">
                            <div class="config-row-title">ğŸ›’ é»‘å¸‚å‘¨è´­ä¹°</div>
                            <div class="config-row-items">
                                <div class="config-inline-item">
                                    <span class="label">é»‘å¸‚å‘¨è´­ä¹°:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.é»‘å¸‚å‘¨è´­ä¹°?.å¯ç”¨ !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'é»‘å¸‚å‘¨è´­ä¹°', 'å¯ç”¨', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- é»‘å¸‚å‘¨è´­ä¹°å­é€‰é¡¹ -->
                        <div class="simple-tasks-row">
                            <div class="simple-task-item">
                                <span class="simple-task-label">è´­ä¹°å®ç®±:</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" ${config.é»‘å¸‚å‘¨è´­ä¹°?.è´­ä¹°å®ç®± !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'é»‘å¸‚å‘¨è´­ä¹°', 'è´­ä¹°å®ç®±', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="simple-task-item">
                                <span class="simple-task-label">è´­ä¹°é‡‘é±¼æ†:</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" ${config.é»‘å¸‚å‘¨è´­ä¹°?.è´­ä¹°é‡‘é±¼æ† !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'é»‘å¸‚å‘¨è´­ä¹°', 'è´­ä¹°é‡‘é±¼æ†', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="simple-task-item">
                                <span class="simple-task-label">è´­ä¹°è´å£³:</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" ${config.é»‘å¸‚å‘¨è´­ä¹°?.è´­ä¹°è´å£³ !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'é»‘å¸‚å‘¨è´­ä¹°', 'è´­ä¹°è´å£³', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="simple-task-item">
                                <span class="simple-task-label">è´­ä¹°ç™½ç‰:</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" ${config.é»‘å¸‚å‘¨è´­ä¹°?.è´­ä¹°ç™½ç‰ !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'é»‘å¸‚å‘¨è´­ä¹°', 'è´­ä¹°ç™½ç‰', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>

                        <!-- å®åº“ç»„ -->
                        <div class="config-row-group">
                            <div class="config-row-title">ğŸ° å®åº“</div>
                            <div class="config-row-items">
                                <div class="config-inline-item">
                                    <span class="label">å®åº“:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.å®åº“?.å¯ç”¨ ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'å®åº“', 'å¯ç”¨', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="config-inline-item">
                                    <span class="label">å‰ä¸‰å±‚:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.å®åº“?.å‰ä¸‰å±‚ !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'å®åº“', 'å‰ä¸‰å±‚', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="config-inline-item">
                                    <span class="label">å››äº”å±‚:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.å®åº“?.å››äº”å±‚ !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'å®åº“', 'å››äº”å±‚', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- å’¸å°†å¡”ç»„ -->
                        <div class="config-row-group">
                            <div class="config-row-title">ğŸ—¼ å’¸å°†å¡”</div>
                            <div class="config-row-items">
                                <div class="config-inline-item">
                                    <span class="label">å’¸å°†å¡”:</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" ${config.å’¸å°†å¡”?.å¯ç”¨ !== false ? 'checked' : ''} onchange="updateNestedConfig('${name}', 'å’¸å°†å¡”', 'å¯ç”¨', this.checked)">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="config-inline-item">
                                    <span class="label">çˆ¬å¡”é˜µå®¹:</span>
                                    <div class="number-input-group">
                                        <button class="number-btn decrease" onclick="adjustNestedNumber('${name}', 'å’¸å°†å¡”', 'çˆ¬å¡”é˜µå®¹', -1)">-</button>
                                        <input type="number" value="${config.å’¸å°†å¡”?.çˆ¬å¡”é˜µå®¹ || 1}" min="1" max="5" onchange="updateNestedConfig('${name}', 'å’¸å°†å¡”', 'çˆ¬å¡”é˜µå®¹', parseInt(this.value))">
                                        <button class="number-btn increase" onclick="adjustNestedNumber('${name}', 'å’¸å°†å¡”', 'çˆ¬å¡”é˜µå®¹', 1)">+</button>
                                    </div>
                                </div>
                                <div class="config-inline-item">
                                    <span class="label">æœ€å¤§å°é±¼å¹²æ•°:</span>
                                    <div class="number-input-group">
                                        <button class="number-btn decrease" onclick="adjustNestedNumber('${name}', 'å’¸å°†å¡”', 'æœ€å¤§å°é±¼å¹²æ•°', -1)">-</button>
                                        <input type="number" value="${config.å’¸å°†å¡”?.æœ€å¤§å°é±¼å¹²æ•° || 10}" min="1" max="50" onchange="updateNestedConfig('${name}', 'å’¸å°†å¡”', 'æœ€å¤§å°é±¼å¹²æ•°', parseInt(this.value))">
                                        <button class="number-btn increase" onclick="adjustNestedNumber('${name}', 'å’¸å°†å¡”', 'æœ€å¤§å°é±¼å¹²æ•°', 1)">+</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>`;
        }
        
        function toggleDetail(name) {
            const detailRow = document.getElementById(`detail-row-${name}`);
            const dataRow = document.getElementById(`data-row-${name}`);
            const expandIcon = dataRow.querySelector('.expand-icon');
            
            if (expandedAccount === name) {
                expandedAccount = null;
                detailRow.classList.remove('show');
                dataRow.classList.remove('expanded');
                expandIcon.classList.remove('open');
            } else {
                if (expandedAccount) {
                    const prevDetail = document.getElementById(`detail-row-${expandedAccount}`);
                    const prevData = document.getElementById(`data-row-${expandedAccount}`);
                    const prevIcon = prevData.querySelector('.expand-icon');
                    if (prevDetail) prevDetail.classList.remove('show');
                    if (prevData) prevData.classList.remove('expanded');
                    if (prevIcon) prevIcon.classList.remove('open');
                }
                expandedAccount = name;
                detailRow.classList.add('show');
                dataRow.classList.add('expanded');
                expandIcon.classList.add('open');
            }
        }
        
        function openTools(name) {
            // åˆ‡æ¢åˆ°å·¥å…·ç®±é¡µé¢ï¼Œå¹¶ä¼ é€’è´¦å·å‚æ•°
            showPage('tools');
            const frame = document.getElementById('toolsFrame');
            frame.src = 'tools.html?account=' + encodeURIComponent(name);
        }
        
        function toggleConfig(name) {
            const configRow = document.getElementById(`config-row-${name}`);
            const detailRow = document.getElementById(`detail-row-${name}`);
            const isVisible = configRow.classList.contains('show');
            
            if (isVisible) {
                configRow.classList.remove('show');
            } else {
                // å…³é—­å…¶ä»–è´¦å·çš„é…ç½®é¢æ¿
                document.querySelectorAll('.config-row.show').forEach(row => {
                    row.classList.remove('show');
                });
                
                // æ˜¾ç¤ºå½“å‰é…ç½®é¢æ¿
                configRow.classList.add('show');
                
                // å¦‚æœè¯¦æƒ…é¢æ¿æ²¡æœ‰å±•å¼€ï¼Œä¸è¦è‡ªåŠ¨å±•å¼€
                // ä¿æŒè¯¦æƒ…é¢æ¿å’Œé…ç½®é¢æ¿ç‹¬ç«‹
            }
        }
        
        function updateConfig(name, key, value) {
            if (!currentConfig) currentConfig = {};
            if (!currentConfig[name]) currentConfig[name] = {};
            currentConfig[name][key] = value;
        }
        
        function updateNestedConfig(name, taskName, key, value) {
            if (!currentConfig) currentConfig = {};
            if (!currentConfig[name]) currentConfig[name] = {};
            
            // å¤„ç†è´¦å·æ€»å¼€å…³ï¼ˆkeyä¸ºnullçš„æƒ…å†µï¼‰
            if (key === null) {
                currentConfig[name][taskName] = value;
            } else {
                // å¤„ç†åµŒå¥—ä»»åŠ¡é…ç½®
                if (!currentConfig[name][taskName]) currentConfig[name][taskName] = {};
                currentConfig[name][taskName][key] = value;
            }
            
            // è‡ªåŠ¨ä¿å­˜
            autoSaveConfig(name);
        }
        
        // é˜²æŠ–ä¿å­˜ï¼ˆé¿å…é¢‘ç¹ä¿å­˜ï¼‰
        let saveTimers = {};
        function autoSaveConfig(name) {
            if (saveTimers[name]) {
                clearTimeout(saveTimers[name]);
            }
            saveTimers[name] = setTimeout(() => {
                saveAccountConfig(name);
            }, 500); // 500ms é˜²æŠ–
        }
        
        function adjustNumber(name, key, delta) {
            const current = currentConfig?.[name]?.[key] || 8;
            const newValue = Math.max(1, Math.min(24, current + delta));
            updateConfig(name, key, newValue);
            const input = document.querySelector(`#config-row-${name} input[type="number"]`);
            if (input) input.value = newValue;
        }
        
        function adjustNestedNumber(name, taskName, key, delta) {
            const current = currentConfig?.[name]?.[taskName]?.[key] || getDefaultValue(key);
            const { min, max } = getValueRange(key);
            const newValue = Math.max(min, Math.min(max, current + delta));
            updateNestedConfig(name, taskName, key, newValue);
            
            // æ›´æ–°å¯¹åº”çš„è¾“å…¥æ¡†
            const configRow = document.getElementById(`config-row-${name}`);
            if (configRow) {
                const inputs = configRow.querySelectorAll('input[type="number"]');
                inputs.forEach(input => {
                    if (parseInt(input.value) === current) {
                        input.value = newValue;
                    }
                });
            }
        }
        
        function getDefaultValue(key) {
            const defaults = {
                'æ—¶é•¿': 8,
                'ç«æŠ€åœºé˜µå®¹': 1,
                'æˆ˜æ–—æ¬¡æ•°': 3,
                'BOSSé˜µå®¹': 1,
                'æ¢¦å¢ƒé˜µå®¹': 1,
                'çˆ¬å¡”é˜µå®¹': 1,
                'æœ€å¤§å°é±¼å¹²æ•°': 10
            };
            return defaults[key] || 1;
        }
        
        function getValueRange(key) {
            const ranges = {
                'æ—¶é•¿': { min: 1, max: 24 },
                'ç«æŠ€åœºé˜µå®¹': { min: 1, max: 5 },
                'æˆ˜æ–—æ¬¡æ•°': { min: 1, max: 10 },
                'BOSSé˜µå®¹': { min: 1, max: 5 },
                'æ¢¦å¢ƒé˜µå®¹': { min: 1, max: 5 },
                'çˆ¬å¡”é˜µå®¹': { min: 1, max: 5 },
                'æœ€å¤§å°é±¼å¹²æ•°': { min: 1, max: 50 }
            };
            return ranges[key] || { min: 1, max: 10 };
        }
        
        async function saveAccountConfig(name) {
            try {
                // è¯»å–å½“å‰å®Œæ•´é…ç½®
                const response = await fetch(`/data/task-config.json?t=${Date.now()}`);
                let fullConfig = {};
                if (response.ok) {
                    fullConfig = await response.json();
                }
                
                // æ›´æ–°æŒ‡å®šè´¦å·çš„é…ç½®
                if (!fullConfig.è´¦å·é…ç½®) fullConfig.è´¦å·é…ç½® = {};
                fullConfig.è´¦å·é…ç½®[name] = currentConfig[name];
                
                // ä¿å­˜å®Œæ•´é…ç½®
                const saveResponse = await fetch(`${API_BASE}/api/save-config`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(fullConfig)
                });
                
                const result = await saveResponse.json();
                if (result.success) {
                    showSaveStatus();
                    console.log(`âœ“ ${name} é…ç½®ä¿å­˜æˆåŠŸ`);
                } else {
                    throw new Error(result.message || 'ä¿å­˜å¤±è´¥');
                }
            } catch (e) {
                console.error('ä¿å­˜é…ç½®å¤±è´¥:', e);
                alert('ä¿å­˜é…ç½®å¤±è´¥: ' + e.message);
            }
        }
        
        function showSaveStatus() {
            const status = document.getElementById('saveStatus');
            status.classList.add('show');
            setTimeout(() => status.classList.remove('show'), 2000);
        }
        
        function startCountdown(name, status) {
            const now = Date.now() / 1000;
            
            // ç›ç½å€’è®¡æ—¶ - æ˜¾ç¤ºå‰©ä½™æ—¶é—´ï¼ˆé€’å‡ï¼‰
            const bottleHelper = status?.bottleHelper;
            if (bottleHelper) {
                const hst = bottleHelper.helperStopTime || 0;
                const isRunning = bottleHelper.isRunning || (hst > now);
                if (isRunning && hst > now) {
                    // ç«‹å³æ›´æ–°ä¸€æ¬¡
                    const elem = document.getElementById(`bottle-${name}`);
                    if (elem) {
                        const remaining = Math.floor(hst - Date.now() / 1000);
                        elem.textContent = formatShortTime(remaining);
                    }
                    
                    // è®¾ç½®å€’è®¡æ—¶å®šæ—¶å™¨ï¼ˆé€’å‡ï¼‰
                    countdowns[`bottle-${name}`] = setInterval(() => {
                        const elem = document.getElementById(`bottle-${name}`);
                        if (elem) {
                            const remaining = Math.floor(hst - Date.now() / 1000);
                            if (remaining > 0) {
                                elem.textContent = formatShortTime(remaining);
                            } else {
                                elem.parentElement.innerHTML = '<span class="badge gray">å·²åœæ­¢</span>';
                                clearInterval(countdowns[`bottle-${name}`]);
                                delete countdowns[`bottle-${name}`];
                            }
                        } else {
                            clearInterval(countdowns[`bottle-${name}`]);
                            delete countdowns[`bottle-${name}`];
                        }
                    }, 1000);
                }
            }
            
            // æŒ‚æœºæ­£è®¡æ—¶ - æ˜¾ç¤ºå·²æŒ‚æœºæ—¶é•¿ï¼ˆé€’å¢ï¼‰
            const hangUp = status?.hangUp;
            if (hangUp) {
                const lastTime = hangUp.lastTime || 0;
                const hangUpTime = hangUp.hangUpTime || 0;
                if (lastTime > 0) {
                    // ç«‹å³æ›´æ–°ä¸€æ¬¡
                    const elem = document.getElementById(`hangup-${name}`);
                    if (elem) {
                        const elapsedTime = Math.floor(Date.now() / 1000 - lastTime);
                        elem.textContent = formatShortTime(elapsedTime);
                    }
                    
                    // è®¾ç½®æ­£è®¡æ—¶å®šæ—¶å™¨ï¼ˆé€’å¢ï¼‰
                    countdowns[`hangup-${name}`] = setInterval(() => {
                        const elem = document.getElementById(`hangup-${name}`);
                        if (elem) {
                            const currentTime = Date.now() / 1000;
                            const elapsedTime = Math.floor(currentTime - lastTime);
                            
                            // æ£€æŸ¥æ˜¯å¦è¿˜åœ¨æŒ‚æœºä¸­
                            if (hangUpTime > 0) {
                                const remainingTime = Math.max(0, Math.floor(hangUpTime - (currentTime - lastTime)));
                                if (remainingTime > 0) {
                                    // è¿˜åœ¨æŒ‚æœºä¸­ï¼Œæ˜¾ç¤ºå·²æŒ‚æœºæ—¶é•¿ï¼ˆé€’å¢ï¼‰
                                    elem.textContent = formatShortTime(elapsedTime);
                                } else {
                                    // æŒ‚æœºå®Œæˆ
                                    elem.parentElement.innerHTML = '<span class="badge warning">å·²å®Œæˆ</span>';
                                    clearInterval(countdowns[`hangup-${name}`]);
                                    delete countdowns[`hangup-${name}`];
                                }
                            } else {
                                // æ— é™æŒ‚æœºï¼ŒæŒç»­æ˜¾ç¤ºå·²æŒ‚æœºæ—¶é•¿ï¼ˆé€’å¢ï¼‰
                                elem.textContent = formatShortTime(elapsedTime);
                            }
                        } else {
                            clearInterval(countdowns[`hangup-${name}`]);
                            delete countdowns[`hangup-${name}`];
                        }
                    }, 1000);
                }
            }
        }
        
        // BINç®¡ç†é¡µ
        async function loadBinFiles() {
            try {
                console.log('å¼€å§‹åŠ è½½BINæ–‡ä»¶åˆ—è¡¨...');
                const response = await fetch(`${API_BASE}/api/bin-files`);
                console.log('æ–‡ä»¶åˆ—è¡¨å“åº”çŠ¶æ€:', response.status, response.statusText);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const contentType = response.headers.get('content-type');
                console.log('å“åº”å†…å®¹ç±»å‹:', contentType);
                
                let data;
                if (contentType && contentType.includes('application/json')) {
                    data = await response.json();
                } else {
                    const text = await response.text();
                    console.log('éJSONå“åº”:', text);
                    try {
                        data = JSON.parse(text);
                    } catch (parseError) {
                        throw new Error(`æœåŠ¡å™¨å“åº”æ ¼å¼é”™è¯¯: ${text}`);
                    }
                }
                
                console.log('è§£æåçš„æ•°æ®:', data);
                const container = document.getElementById('fileListContent');
                
                if (!data.success) {
                    container.innerHTML = '<div class="no-data"><div class="no-data-icon">âŒ</div><div class="no-data-text">åŠ è½½å¤±è´¥: ' + (data.message || 'æœªçŸ¥é”™è¯¯') + '</div></div>';
                    return;
                }
                
                const files = data.files || [];
                console.log('æ–‡ä»¶åˆ—è¡¨:', files);
                
                if (!files.length) {
                    container.innerHTML = '<div class="no-data"><div class="no-data-icon">ğŸ“</div><div class="no-data-text">æš‚æ— BINæ–‡ä»¶</div></div>';
                    return;
                }
                
                // è·å–æŒ‚æœºé…ç½®çŠ¶æ€
                let hangupConfig = {};
                try {
                    console.log('è·å–æŒ‚æœºé…ç½®...');
                    const hangupResponse = await fetch(`${API_BASE}/api/hangup-config`);
                    const hangupData = await hangupResponse.json();
                    console.log('æŒ‚æœºé…ç½®æ•°æ®:', hangupData);
                    if (hangupData.success) {
                        hangupConfig = hangupData.config || {};
                    }
                } catch (e) {
                    console.warn('è·å–æŒ‚æœºé…ç½®å¤±è´¥:', e);
                }
                
                let html = '';
                files.forEach(file => {
                    console.log('å¤„ç†æ–‡ä»¶:', file);
                    
                    // ä»æ–‡ä»¶åä¸­æå–è´¦å·åç§°ï¼ˆå»æ‰.binåç¼€ï¼‰
                    const accountName = file.name.replace(/\.bin$/i, '');
                    const isEnabled = hangupConfig[accountName] === true;
                    console.log(`æ–‡ä»¶ ${file.name} -> è´¦å·: ${accountName}, æŒ‚æœºå¯ç”¨: ${isEnabled}`);
                    
                    // æ‰€æœ‰BINæ–‡ä»¶éƒ½æ˜¾ç¤ºæŒ‚æœºå¼€å…³
                    const hangupToggle = `<span class="hangup-label">æŒ‚æœº:</span>
                        <label class="toggle-switch">
                            <input type="checkbox" ${isEnabled ? 'checked' : ''} onchange="toggleHangup('${file.name}', this.checked)">
                            <span class="slider"></span>
                        </label>`;
                    
                    html += `<div class="file-item">
                        <div class="file-info">
                            <div class="file-name">${file.name}</div>
                            <div class="file-meta">å¤§å°: ${(file.size / 1024).toFixed(1)}KB | åˆ›å»ºæ—¶é—´: ${new Date(file.created).toLocaleString()}</div>
                        </div>
                        <div class="file-actions">
                            ${hangupToggle}
                            <button class="btn danger" onclick="deleteBinFile('${file.name}')">ğŸ—‘ï¸</button>
                        </div>
                    </div>`;
                });
                container.innerHTML = html;
                console.log('âœ“ BINæ–‡ä»¶åˆ—è¡¨åŠ è½½å®Œæˆï¼Œå…±', files.length, 'ä¸ªæ–‡ä»¶');
            } catch (e) {
                console.error('åŠ è½½BINæ–‡ä»¶å¤±è´¥:', e);
                document.getElementById('fileListContent').innerHTML = '<div class="no-data"><div class="no-data-icon">âŒ</div><div class="no-data-text">åŠ è½½å¤±è´¥: ' + e.message + '</div></div>';
            }
        }
        
        async function deleteBinFile(filename) {
            if (!confirm(`ç¡®å®šè¦åˆ é™¤ ${filename} å—ï¼Ÿ`)) return;
            try {
                console.log(`å¼€å§‹åˆ é™¤ ${filename}...`);
                const response = await fetch(`${API_BASE}/api/delete-bin/${encodeURIComponent(filename)}`, { 
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('åˆ é™¤å“åº”çŠ¶æ€:', response.status, response.statusText);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const contentType = response.headers.get('content-type');
                console.log('å“åº”å†…å®¹ç±»å‹:', contentType);
                
                let data;
                if (contentType && contentType.includes('application/json')) {
                    data = await response.json();
                } else {
                    const text = await response.text();
                    console.log('éJSONå“åº”:', text);
                    try {
                        data = JSON.parse(text);
                    } catch (parseError) {
                        throw new Error(`æœåŠ¡å™¨å“åº”æ ¼å¼é”™è¯¯: ${text}`);
                    }
                }
                
                console.log('è§£æåçš„æ•°æ®:', data);
                
                if (data.success) {
                    console.log(`âœ“ ${filename} åˆ é™¤æˆåŠŸ:`, data.message);
                    alert(`âœ“ ${filename} åˆ é™¤æˆåŠŸï¼`);
                    // å»¶è¿Ÿåˆ·æ–°ï¼Œç¡®ä¿åç«¯å¤„ç†å®Œæˆ
                    setTimeout(() => {
                        loadBinFiles();
                    }, 1000);
                } else {
                    throw new Error(data.message || 'åˆ é™¤å¤±è´¥');
                }
            } catch (e) {
                console.error('åˆ é™¤æ–‡ä»¶å¤±è´¥:', e);
                alert('åˆ é™¤æ–‡ä»¶å¤±è´¥: ' + e.message);
            }
        }
        
        async function toggleHangup(filename, enabled) {
            try {
                console.log(`åˆ‡æ¢æŒ‚æœºçŠ¶æ€: ${filename} -> ${enabled}`);
                // ä»æ–‡ä»¶åä¸­æå–è´¦å·åç§°ï¼ˆå»æ‰.binåç¼€ï¼‰
                let accountName = filename.replace(/\.bin$/i, '');
                console.log(`æå–çš„è´¦å·åç§°: ${accountName}`);
                
                const response = await fetch(`${API_BASE}/api/hangup-config/${encodeURIComponent(accountName)}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ enabled })
                });
                
                console.log('æŒ‚æœºé…ç½®å“åº”çŠ¶æ€:', response.status, response.statusText);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('æŒ‚æœºé…ç½®å“åº”æ•°æ®:', data);
                
                if (!data.success) {
                    throw new Error(data.message || 'æ“ä½œå¤±è´¥');
                }
                
                console.log(`âœ“ ${accountName} æŒ‚æœº${enabled ? 'å¼€å¯' : 'å…³é—­'}æˆåŠŸ`);
                // å¯é€‰ï¼šæ˜¾ç¤ºæˆåŠŸæç¤º
                // alert(`${accountName} æŒ‚æœº${enabled ? 'å¼€å¯' : 'å…³é—­'}æˆåŠŸ`);
            } catch (e) {
                console.error('æŒ‚æœºè®¾ç½®å¤±è´¥:', e);
                alert('æŒ‚æœºè®¾ç½®å¤±è´¥: ' + e.message);
                // æ¢å¤å¼€å…³çŠ¶æ€
                const checkbox = event.target;
                if (checkbox) {
                    checkbox.checked = !enabled;
                }
            }
        }
        
        // æ–‡ä»¶ä¸Šä¼ 
        document.getElementById('uploadArea').addEventListener('click', () => {
            document.getElementById('fileInput').click();
        });
        
        document.getElementById('fileInput').addEventListener('change', handleFileUpload);
        
        // æ‹–æ‹½ä¸Šä¼ 
        const uploadArea = document.getElementById('uploadArea');
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            handleFileUpload({ target: { files: e.dataTransfer.files } });
        });
        
        async function handleFileUpload(event) {
            const files = Array.from(event.target.files);
            if (!files.length) return;
            
            for (const file of files) {
                if (!file.name.endsWith('.bin')) {
                    alert(`${file.name} ä¸æ˜¯BINæ–‡ä»¶`);
                    continue;
                }
                
                const formData = new FormData();
                formData.append('file', file);
                
                try {
                    console.log(`å¼€å§‹ä¸Šä¼  ${file.name}...`);
                    const response = await fetch(`${API_BASE}/api/upload-bin`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    console.log('ä¸Šä¼ å“åº”çŠ¶æ€:', response.status, response.statusText);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const contentType = response.headers.get('content-type');
                    console.log('å“åº”å†…å®¹ç±»å‹:', contentType);
                    
                    let data;
                    if (contentType && contentType.includes('application/json')) {
                        data = await response.json();
                    } else {
                        const text = await response.text();
                        console.log('éJSONå“åº”:', text);
                        try {
                            data = JSON.parse(text);
                        } catch (parseError) {
                            throw new Error(`æœåŠ¡å™¨å“åº”æ ¼å¼é”™è¯¯: ${text}`);
                        }
                    }
                    
                    console.log('è§£æåçš„æ•°æ®:', data);
                    
                    if (data.success) {
                        console.log(`âœ“ ${file.name} ä¸Šä¼ æˆåŠŸ:`, data.message);
                        alert(`âœ“ ${file.name} ä¸Šä¼ æˆåŠŸï¼`);
                    } else {
                        throw new Error(data.message || 'ä¸Šä¼ å¤±è´¥');
                    }
                } catch (e) {
                    console.error(`ä¸Šä¼  ${file.name} å¤±è´¥:`, e);
                    alert(`ä¸Šä¼  ${file.name} å¤±è´¥: ${e.message}`);
                }
            }
            
            // å»¶è¿Ÿåˆ·æ–°ï¼Œç¡®ä¿åç«¯å¤„ç†å®Œæˆ
            setTimeout(() => {
                loadBinFiles();
            }, 1000);
            document.getElementById('fileInput').value = '';
        }
        
        // æ—¥å¿—é¡µ
        async function loadLogs() {
            try {
                const response = await fetch(`${API_BASE}/api/logs`);
                const result = await response.json();
                const container = document.getElementById('logContainer');
                
                if (!result.success || !result.logs || !result.logs.trim()) {
                    container.innerHTML = '<div class="no-data"><div class="no-data-icon">ğŸ“</div><div class="no-data-text">æš‚æ— æ—¥å¿—</div></div>';
                    return;
                }
                
                const lines = result.logs.split('\n').slice(-500); // æœ€è¿‘500è¡Œ
                let html = '';
                lines.forEach(line => {
                    if (!line.trim()) return;
                    let className = 'log-line';
                    if (line.includes('[INFO]')) className += ' log-info';
                    else if (line.includes('[OK]')) className += ' log-ok';
                    else if (line.includes('[ERROR]')) className += ' log-error';
                    else if (line.includes('[WARN]')) className += ' log-warn';
                    
                    // è½¬ä¹‰HTMLç‰¹æ®Šå­—ç¬¦
                    const escapedLine = line.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                    html += `<div class="${className}">${escapedLine}</div>`;
                });
                
                container.innerHTML = html;
                container.scrollTop = container.scrollHeight;
            } catch (e) {
                console.error('åŠ è½½æ—¥å¿—å¤±è´¥:', e);
                document.getElementById('logContainer').innerHTML = '<div class="no-data"><div class="no-data-icon">âŒ</div><div class="no-data-text">åŠ è½½æ—¥å¿—å¤±è´¥</div></div>';
            }
        }
        
        function toggleAutoLog() {
            const btn = document.getElementById('autoLogBtn');
            if (isAutoLog) {
                clearInterval(autoLogInterval);
                isAutoLog = false;
                btn.textContent = 'ğŸ”„ è‡ªåŠ¨åˆ·æ–°';
                btn.classList.remove('success');
            } else {
                autoLogInterval = setInterval(loadLogs, 3000);
                isAutoLog = true;
                btn.textContent = 'â¸ï¸ åœæ­¢åˆ·æ–°';
                btn.classList.add('success');
                loadLogs();
            }
        }
        
        // æŒ‚æœºæ—¥å¿—é¡µ
        async function loadHangupData() {
            try {
                const [statusRes, logsRes] = await Promise.all([
                    fetch(`${API_BASE}/api/hangup-status`),
                    fetch(`${API_BASE}/api/hangup-logs`)
                ]);
                
                const status = await statusRes.json();
                const logsResult = await logsRes.json();
                const logs = logsResult.logs || '';
                
                // æ›´æ–°ç»Ÿè®¡ - ä»data.statsè·å–
                const stats = status.data?.stats || {};
                document.getElementById('hTotal').textContent = stats.total || 0;
                document.getElementById('hEnabled').textContent = stats.enabled || 0;
                document.getElementById('hOnline').textContent = stats.online || 0;
                document.getElementById('hOffline').textContent = stats.offline || 0;
                
                // æ›´æ–°æ—¥å¿—
                const logContainer = document.getElementById('hangupLogContainer');
                if (logs.trim()) {
                    const lines = logs.split('\n').slice(-100);
                    let html = '';
                    lines.forEach(line => {
                        if (!line.trim()) return;
                        let className = 'log-line';
                        if (line.includes('ä¸Šçº¿')) className += ' log-ok';
                        else if (line.includes('ç¦»çº¿') || line.includes('æ–­å¼€')) className += ' log-error';
                        else if (line.includes('è¿æ¥')) className += ' log-info';
                        // è½¬ä¹‰HTMLç‰¹æ®Šå­—ç¬¦
                        const escapedLine = line.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                        html += `<div class="${className}">${escapedLine}</div>`;
                    });
                    logContainer.innerHTML = html;
                    logContainer.scrollTop = logContainer.scrollHeight;
                } else {
                    logContainer.innerHTML = '<div class="no-data">æš‚æ— æŒ‚æœºæ—¥å¿—</div>';
                }
                
                // æ›´æ–°è´¦å·ç½‘æ ¼ - ä»data.accountsè·å–
                const grid = document.getElementById('hangupAccountGrid');
                const accounts = status.data?.accounts || [];
                if (accounts.length) {
                    let html = '';
                    accounts.forEach(acc => {
                        const cardClass = acc.hangupEnabled ? (acc.windowExists ? 'hangup-on' : 'hangup-off') : 'hangup-off';
                        const statusText = acc.windowExists ? 'åœ¨çº¿' : (acc.waitingLogin ? `ç­‰å¾…${acc.waitingMinutes}åˆ†é’Ÿ` : 'ç¦»çº¿');
                        const statusClass = acc.windowExists ? 'online' : (acc.waitingLogin ? 'waiting' : 'offline');
                        
                        html += `<div class="account-card ${cardClass}">
                            <div class="account-card-name">${acc.accountName}</div>
                            <div class="account-card-status">
                                <div class="status-row">
                                    <span class="label">æŒ‚æœºçŠ¶æ€:</span>
                                    <span class="value">${acc.hangupEnabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}</span>
                                </div>
                                <div class="status-row">
                                    <span class="label">çª—å£çŠ¶æ€:</span>
                                    <span class="value ${statusClass}">${statusText}</span>
                                </div>
                                <div class="status-row">
                                    <span class="label">æœ€åä»»åŠ¡:</span>
                                    <span class="value">${acc.lastTaskTime || '-'}</span>
                                </div>
                            </div>
                        </div>`;
                    });
                    grid.innerHTML = html;
                } else {
                    grid.innerHTML = '<div class="no-data">æš‚æ— æŒ‚æœºè´¦å·</div>';
                }
            } catch (e) {
                console.error('åŠ è½½æŒ‚æœºæ•°æ®å¤±è´¥:', e);
            }
        }
        
        function toggleAutoHangup() {
            const btn = document.getElementById('autoHangupBtn');
            if (isAutoHangup) {
                clearInterval(autoHangupInterval);
                isAutoHangup = false;
                btn.textContent = 'ğŸ”„ è‡ªåŠ¨åˆ·æ–°';
                btn.classList.remove('success');
            } else {
                autoHangupInterval = setInterval(loadHangupData, 5000);
                isAutoHangup = true;
                btn.textContent = 'â¸ï¸ åœæ­¢åˆ·æ–°';
                btn.classList.add('success');
                loadHangupData();
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            loadStatusData();
        });
    </script>
</body>
</html>