<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´¦å·æ€»è§ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left h1 {
            font-size: 28px;
            color: #333;
            margin-bottom: 5px;
        }

        .header-left .subtitle {
            font-size: 14px;
            color: #666;
        }

        .refresh-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.3s;
        }

        .refresh-btn:hover {
            background: #5568d3;
        }

        .refresh-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .refresh-btn.refreshing {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .section-group {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .stat-title {
            font-size: 16px;
            color: #666;
            font-weight: 500;
        }

        .stat-icon {
            font-size: 24px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        .stat-value.success {
            color: #10b981;
        }

        .stat-value.warning {
            color: #f59e0b;
        }

        .stat-value.danger {
            color: #ef4444;
        }

        .stat-progress {
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 12px;
        }

        .stat-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }

        .stat-progress-bar.success {
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
        }

        .stat-progress-bar.warning {
            background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
        }

        .stat-progress-bar.danger {
            background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
        }

        .last-update {
            text-align: center;
            color: #666;
            font-size: 12px;
            margin-top: 20px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 18px;
        }

        .error {
            text-align: center;
            padding: 40px;
            background: white;
            border-radius: 10px;
            color: #ef4444;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <h1>ğŸ“Š è´¦å·æ€»è§ˆ</h1>
                <div class="subtitle">å®æ—¶ç›‘æ§æ‰€æœ‰è´¦å·çš„ä»»åŠ¡å®Œæˆæƒ…å†µ</div>
            </div>
            <button class="refresh-btn" onclick="loadData()" id="refreshBtn">
                <span>ğŸ”„</span>
                <span>åˆ·æ–°</span>
            </button>
        </div>

        <div id="statsContainer">
            <div class="loading">æ­£åœ¨åŠ è½½æ•°æ®...</div>
        </div>

        <div class="last-update" id="lastUpdate">
            æœ€åæ›´æ–°: --
        </div>
    </div>

    <script>
        // âœ… è„šæœ¬å¼€å§‹æ‰§è¡Œæ ‡è®°
        console.log('=== Dashboardè„šæœ¬å¼€å§‹æ‰§è¡Œ ===');

        // âœ… æ ¼å¼åŒ–æ—¶é—´å‡½æ•°ï¼ˆå…¨å±€ï¼Œç”¨äºå®æ—¶æ›´æ–°ï¼‰
        function æ ¼å¼åŒ–æ—¶é—´(ç§’æ•°) {
            if (!ç§’æ•° || ç§’æ•° <= 0) return '0å°æ—¶';
            const å°æ—¶ = Math.floor(ç§’æ•° / 3600);
            const åˆ†é’Ÿ = Math.floor((ç§’æ•° % 3600) / 60);
            if (å°æ—¶ > 0) {
                return åˆ†é’Ÿ > 0 ? `${å°æ—¶}å°æ—¶${åˆ†é’Ÿ}åˆ†é’Ÿ` : `${å°æ—¶}å°æ—¶`;
            }
            return `${åˆ†é’Ÿ}åˆ†é’Ÿ`;
        }

        // âœ… ä¿å­˜å®æ—¶æ›´æ–°çš„åŸºç¡€æ•°æ®ï¼ˆå¿…é¡»åœ¨æ‰€æœ‰å‡½æ•°ä¹‹å‰å®šä¹‰ï¼‰
        let realTimeData = {
            bottleHelper: {
                accounts: [],  // [{accountName, helperStopTime, remainingTime}]
                totalRemaining: 0,
                count: 0
            },
            hangUp: {
                accounts: [],  // [{accountName, lastTime, hangUpTime, remainingTime, elapsedTime}]
                totalRemaining: 0,
                totalElapsed: 0,
                count: 0
            }
        };

        // âœ… å®æ—¶æ›´æ–°æ—¶é—´æ˜¾ç¤ºï¼ˆæ ¹æ®ç»å¯¹æ—¶é—´æˆ³è®¡ç®—ï¼‰
        function updateRealTimeDisplay() {
            const now = Date.now() / 1000; // å½“å‰æ—¶é—´ï¼ˆç§’ï¼‰

            // æ›´æ–°ç›ç½æœºå™¨äºº
            const bottleSubtitleEl = document.getElementById('bottle-helper-subtitle');
            if (bottleSubtitleEl) {
                if (realTimeData.bottleHelper.accounts.length > 0) {
                    let totalRemaining = 0;
                    let validCount = 0;

                    realTimeData.bottleHelper.accounts.forEach(account => {
                        // âœ… æ ¹æ®ç»å¯¹æ—¶é—´æˆ³è®¡ç®—å®é™…å‰©ä½™æ—¶é—´
                        const helperStopTime = account.helperStopTime || 0;
                        const actualRemaining = Math.max(0, Math.floor(helperStopTime - now));
                        if (actualRemaining > 0) {
                            totalRemaining += actualRemaining;
                            validCount++;
                        }
                    });

                    if (validCount > 0) {
                        const avgRemaining = Math.round(totalRemaining / validCount);
                        const displayText = æ ¼å¼åŒ–æ—¶é—´(avgRemaining);
                        bottleSubtitleEl.textContent = `å¹³å‡å‰©ä½™: ${displayText}`;
                    } else {
                        bottleSubtitleEl.textContent = 'æœªè¿è¡Œ';
                    }
                } else {
                    bottleSubtitleEl.textContent = 'æœªè¿è¡Œ';
                }
            }

            // æ›´æ–°æŒ‚æœºçŠ¶æ€
            const hangupSubtitleEl = document.getElementById('hangup-subtitle');
            if (hangupSubtitleEl) {
                if (realTimeData.hangUp.accounts.length > 0) {
                    let totalRemaining = 0;
                    let totalElapsed = 0;
                    let validCount = 0;

                    realTimeData.hangUp.accounts.forEach(account => {
                        // âœ… æ ¹æ®ç»å¯¹æ—¶é—´æˆ³è®¡ç®—å®é™…å‰©ä½™æ—¶é—´å’Œå·²æŒ‚æ—¶é—´
                        const lastTime = account.lastTime || 0;
                        const hangUpTime = account.hangUpTime || 0;
                        const actualElapsed = Math.max(0, Math.floor(now - lastTime));
                        const actualRemaining = Math.max(0, Math.floor(hangUpTime - actualElapsed));

                        if (actualRemaining > 0) {
                            totalRemaining += actualRemaining;
                            totalElapsed += actualElapsed;
                            validCount++;
                        }
                    });

                    if (validCount > 0) {
                        const avgRemaining = Math.round(totalRemaining / validCount);
                        const avgElapsed = Math.round(totalElapsed / validCount);
                        const displayText = `å¹³å‡å‰©ä½™: ${æ ¼å¼åŒ–æ—¶é—´(avgRemaining)} | å¹³å‡å·²æŒ‚: ${æ ¼å¼åŒ–æ—¶é—´(avgElapsed)}`;
                        hangupSubtitleEl.textContent = displayText;
                    } else {
                        hangupSubtitleEl.textContent = 'æœªè¿è¡Œ';
                    }
                } else {
                    hangupSubtitleEl.textContent = 'æœªè¿è¡Œ';
                }
            }
        }

        // âœ… å¯åŠ¨å®æ—¶æ›´æ–°å®šæ—¶å™¨ï¼ˆæ¯ç§’æ›´æ–°ä¸€æ¬¡æ˜¾ç¤ºï¼‰
        function startRealTimeUpdate() {
            if (timeUpdateInterval) {
                clearInterval(timeUpdateInterval);
            }
            console.log('å¯åŠ¨å®æ—¶æ›´æ–°å®šæ—¶å™¨ï¼ˆæ¯ç§’æ›´æ–°ä¸€æ¬¡æ˜¾ç¤ºï¼‰');
            timeUpdateInterval = setInterval(() => {
                updateRealTimeDisplay();
            }, 1000); // æ¯ç§’æ›´æ–°ä¸€æ¬¡æ˜¾ç¤º
            // ç«‹å³æ‰§è¡Œä¸€æ¬¡
            updateRealTimeDisplay();
        }

        // âœ… å¯åŠ¨å®æ—¶æ›´æ–°å®šæ—¶å™¨ï¼ˆå·²åºŸå¼ƒï¼Œæ”¹ä¸ºä½¿ç”¨startAutoRefreshæ¯30ç§’é‡æ–°è·å–æ•°æ®ï¼‰
        function startRealTimeUpdate() {
            // ä¸å†éœ€è¦æ­¤å‡½æ•°ï¼Œæ•°æ®ä¼šé€šè¿‡ startAutoRefresh() æ¯30ç§’é‡æ–°è·å–
            console.log('å®æ—¶æ›´æ–°å·²æ”¹ä¸ºæ¯30ç§’é‡æ–°è·å–æ•°æ®');
        }

        let autoRefreshInterval = null;
        let isRefreshing = false;
        let timeUpdateInterval = null;

        // åŠ è½½æ•°æ®
        async function loadData() {
            if (isRefreshing) return; // é˜²æ­¢é‡å¤åˆ·æ–°
            isRefreshing = true;

            // âœ… æ¸…ç©ºå®æ—¶æ›´æ–°æ•°æ®ï¼ˆæ¯æ¬¡åˆ·æ–°æ—¶é‡æ–°æ”¶é›†ï¼‰
            realTimeData.bottleHelper.accounts = [];
            realTimeData.hangUp.accounts = [];

            // æ›´æ–°åˆ·æ–°æŒ‰é’®çŠ¶æ€
            const refreshBtn = document.getElementById('refreshBtn');
            if (refreshBtn) {
                refreshBtn.disabled = true;
                refreshBtn.classList.add('refreshing');
            }

            try {
                const timestamp = new Date().getTime();

                // è¯»å–tokens.json
                const tokensRes = await fetch(`/data/tokens.json?t=${timestamp}`);
                if (!tokensRes.ok) {
                    throw new Error('æœªæ‰¾åˆ°tokens.jsonï¼Œè¯·å…ˆè½¬æ¢BINæ–‡ä»¶');
                }
                const tokens = await tokensRes.json();
                const totalAccounts = tokens.length;

                // è¯»å–account-status.json
                let statusData = {};
                try {
                    const statusRes = await fetch(`/data/account-status.json?t=${timestamp}`);
                    if (statusRes.ok) {
                        statusData = await statusRes.json();
                    }
                } catch (e) {
                    console.log('æš‚æ— çŠ¶æ€æ•°æ®æ–‡ä»¶');
                }

                // âœ… è¯»å–task-schedule-record.jsonï¼ˆç”¨äºè·å–æ‰§è¡Œæ—¶é—´ï¼‰
                let executionRecord = {};
                try {
                    const recordRes = await fetch(`/data/task-schedule-record.json?t=${timestamp}`);
                    if (recordRes.ok) {
                        executionRecord = await recordRes.json();
                    }
                } catch (e) {
                    console.log('æš‚æ— æ‰§è¡Œè®°å½•æ–‡ä»¶');
                }

                // ç»Ÿè®¡å„é¡¹æ•°æ®
                const stats = calculateStats(tokens, statusData, executionRecord);

                // æ¸²æŸ“ç»Ÿè®¡å¡ç‰‡
                renderStats(stats, totalAccounts, tokens, statusData);

                // âœ… æ•°æ®åŠ è½½å®Œæˆåç«‹å³æ›´æ–°ä¸€æ¬¡å®æ—¶æ˜¾ç¤ºï¼ˆå»¶è¿Ÿç¡®ä¿DOMå·²æ¸²æŸ“ï¼‰
                setTimeout(() => {
                    updateRealTimeDisplay();
                }, 200);

                // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´ï¼ˆæ˜¾ç¤ºä¸‹æ¬¡è‡ªåŠ¨åˆ·æ–°æ—¶é—´ï¼‰
                const nextRefreshTime = new Date(Date.now() + 30000);
                document.getElementById('lastUpdate').textContent = `æœ€åæ›´æ–°: ${new Date().toLocaleString('zh-CN')} | ä¸‹æ¬¡è‡ªåŠ¨åˆ·æ–°: ${nextRefreshTime.toLocaleTimeString('zh-CN')}`;

            } catch (error) {
                document.getElementById('statsContainer').innerHTML = `
                    <div class="error">
                        <div style="font-size: 48px; margin-bottom: 10px;">âŒ</div>
                        <div>åŠ è½½å¤±è´¥</div>
                        <div style="margin-top: 10px; font-size: 14px; color: #999;">${error.message}</div>
                    </div>
                `;
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
            } finally {
                isRefreshing = false;
                // æ¢å¤åˆ·æ–°æŒ‰é’®çŠ¶æ€
                const refreshBtn = document.getElementById('refreshBtn');
                if (refreshBtn) {
                    refreshBtn.disabled = false;
                    refreshBtn.classList.remove('refreshing');
                }
            }
        }

        // âœ… æ´»åŠ¨å‘¨ç±»å‹åˆ¤æ–­é€»è¾‘ï¼ˆå‰ç«¯å®ç°ï¼‰
        function è®¡ç®—æ´»åŠ¨å‘¨å¼€å§‹æ—¶é—´(now) {
            const å½“å‰æ—¶é—´ = new Date(now);
            const ä»Šå¤©å‘¨å‡  = å½“å‰æ—¶é—´.getDay();
            const æœ¬å‘¨äº”12ç‚¹ = new Date(å½“å‰æ—¶é—´);
            let è·ç¦»æœ¬å‘¨äº”å¤©æ•° = 0;
            if (ä»Šå¤©å‘¨å‡  < 5) {
                è·ç¦»æœ¬å‘¨äº”å¤©æ•° = 5 - ä»Šå¤©å‘¨å‡ ;
            } else if (ä»Šå¤©å‘¨å‡  === 5) {
                è·ç¦»æœ¬å‘¨äº”å¤©æ•° = 0;
            } else {
                è·ç¦»æœ¬å‘¨äº”å¤©æ•° = 5 - ä»Šå¤©å‘¨å‡  + 7;
            }
            æœ¬å‘¨äº”12ç‚¹.setDate(å½“å‰æ—¶é—´.getDate() + è·ç¦»æœ¬å‘¨äº”å¤©æ•°);
            æœ¬å‘¨äº”12ç‚¹.setHours(12, 0, 0, 0);
            æœ¬å‘¨äº”12ç‚¹.setMinutes(0, 0, 0);
            æœ¬å‘¨äº”12ç‚¹.setSeconds(0, 0);
            æœ¬å‘¨äº”12ç‚¹.setMilliseconds(0);
            if (å½“å‰æ—¶é—´.getTime() < æœ¬å‘¨äº”12ç‚¹.getTime()) {
                æœ¬å‘¨äº”12ç‚¹.setDate(æœ¬å‘¨äº”12ç‚¹.getDate() - 7);
            }
            return æœ¬å‘¨äº”12ç‚¹.getTime();
        }

        function è·å–å½“å‰æ´»åŠ¨å‘¨ç±»å‹(now = new Date()) {
            const æ´»åŠ¨ç±»å‹ = { 0: 'é»‘å¸‚å‘¨', 1: 'æ‹›å‹Ÿå‘¨', 2: 'å®ç®±å‘¨' };
            const åŸºå‡†æ—¶é—´ = new Date('2025-11-21 12:00:00').getTime();
            const å½“å‰æ´»åŠ¨å‘¨å¼€å§‹æ—¶é—´ = è®¡ç®—æ´»åŠ¨å‘¨å¼€å§‹æ—¶é—´(now);
            const å‘¨æœŸæ•° = Math.floor((å½“å‰æ´»åŠ¨å‘¨å¼€å§‹æ—¶é—´ - åŸºå‡†æ—¶é—´) / (7 * 24 * 60 * 60 * 1000));
            const æ´»åŠ¨ç´¢å¼• = å‘¨æœŸæ•° % 3;
            const æœ€ç»ˆç´¢å¼• = æ´»åŠ¨ç´¢å¼• >= 0 ? æ´»åŠ¨ç´¢å¼• : (æ´»åŠ¨ç´¢å¼• + 3) % 3;
            return æ´»åŠ¨ç±»å‹[æœ€ç»ˆç´¢å¼•];
        }

        // è®¡ç®—ç»Ÿè®¡æ•°æ®
        function calculateStats(tokens, statusData, executionRecord) {
            const stats = {
                // æ¯æ—¥ä»»åŠ¡
                dailyTask75: 0,      // 75è¿›åº¦å€¼å®Œæˆ
                dailyTask100: 0,     // 100è¿›åº¦å€¼å®Œæˆ
                dailyTaskAvgPoint: 0, // å¹³å‡è¿›åº¦å€¼
                dailyTaskTotalPoint: 0, // æ€»è¿›åº¦å€¼

                // ç›ç½æœºå™¨äºº
                bottleHelper: 0,     // è¿è¡Œä¸­
                bottleHelperTotalRemaining: 0, // æ€»å‰©ä½™æ—¶é—´ï¼ˆç§’ï¼‰

                // æŒ‚æœºçŠ¶æ€
                hangUp: 0,          // è¿è¡Œä¸­
                hangUpTotalRemaining: 0, // æ€»å‰©ä½™æ—¶é—´ï¼ˆç§’ï¼‰
                hangUpTotalElapsed: 0,   // æ€»å·²æŒ‚æœºæ—¶é—´ï¼ˆç§’ï¼‰

                // ä»Šæ—¥ç­¾åˆ°
                signin: 0,          // å·²ç­¾åˆ°

                // æœ¬å‘¨ç­”é¢˜
                study: 0,           // å·²ç­”é¢˜
                studyTotalScore: 0,  // æ€»åˆ†æ•°
                studyTotalCorrect: 0, // æ€»ç­”å¯¹é¢˜æ•°

                // ç–¯ç‹‚èµ›è½¦
                carKing: 0,         // å·²æ‰§è¡Œï¼ˆå‘¨ä¸€ã€äºŒã€ä¸‰ï¼‰
                carKingTotalSent: 0,  // æ€»å·²å‘è½¦æ•°
                carKingTotalCanClaim: 0, // æ€»å¯æ”¶è½¦æ•°
                carKingTotalTickets: 0,  // æ€»åˆ·æ–°åˆ¸æ•°
                carKingTotalCars: 0,     // æ€»è½¦è¾†æ•°

                // å››åœ£ç¢ç‰‡è´­ä¹°
                legionShop: 0,      // å·²è´­ä¹°ï¼ˆæœ¬å‘¨ï¼‰

                // æ¯æ—¥å’¸ç‹
                dailyBoss: 0,       // å·²æ‰§è¡Œï¼ˆä»Šæ—¥ï¼‰

                // ç¯ç¥
                lampGod: 0,         // å·²æ‰§è¡Œï¼ˆä»Šæ—¥ï¼‰

                // æ¢¦å¢ƒ
                dreamland: 0,       // å·²æ‰§è¡Œï¼ˆæœ¬å‘¨ï¼‰

                // ç«æŠ€åœº
                arena: 0,           // å·²æ‰§è¡Œï¼ˆä»Šæ—¥ï¼‰
                arenaTotalSuccess: 0,   // æ€»æˆåŠŸæ¬¡æ•°
                arenaTotalAttempt: 0,   // æ€»å°è¯•æ¬¡æ•°

                // BOSSæˆ˜æ–—
                bossBattle: 0,      // å·²æ‰§è¡Œï¼ˆä»Šæ—¥ï¼‰

                // å’¸å°†å¡”
                tower: {
                    executed: 0,        // å·²æ‰§è¡Œï¼ˆ6å°æ—¶å†…ï¼‰
                    totalChallenges: 0, // å½“å¤©æŒ‘æˆ˜æ€»æ¬¡æ•°
                    totalSuccess: 0,    // å½“å¤©æˆåŠŸæ€»æ¬¡æ•°
                    totalFail: 0,       // å½“å¤©å¤±è´¥æ€»æ¬¡æ•°
                    hasEnergy: 0,       // æœ‰èƒ½é‡çš„è´¦å·æ•°
                    totalEnergy: 0,     // æ€»èƒ½é‡
                    avgFloorChange: 0,  // æœ¬å‘¨å¹³å‡å±‚æ•°å˜åŒ–
                    maxTowerId: 0       // æœ€é«˜å±‚æ•°
                },

                // æ´»åŠ¨å‘¨
                activityWeek: {
                    type: è·å–å½“å‰æ´»åŠ¨å‘¨ç±»å‹(),  // å½“å‰æ´»åŠ¨å‘¨ç±»å‹
                    purchased: 0,   // å·²è´­ä¹°æ•°é‡ï¼ˆä»…é»‘å¸‚å‘¨ï¼‰
                    total: 0        // æ€»è´¦å·æ•°
                }
            };

            // è·å–ä»Šå¤©å’Œæœ¬å‘¨ä¸€
            const now = new Date();
            const today = now.toDateString();
            const æœ¬å‘¨ä¸€ = new Date(now);
            æœ¬å‘¨ä¸€.setHours(0, 0, 0, 0);
            const è·ç¦»å‘¨ä¸€å¤©æ•° = now.getDay() === 0 ? 6 : now.getDay() - 1;
            æœ¬å‘¨ä¸€.setDate(now.getDate() - è·ç¦»å‘¨ä¸€å¤©æ•°);

            // åˆ¤æ–­æ˜¯å¦åœ¨æœ¬å‘¨å†…
            function æ˜¯å¦åœ¨æœ¬å‘¨å†…(dateString) {
                if (!dateString) return false;
                const date = new Date(dateString);
                return date >= æœ¬å‘¨ä¸€;
            }

            // åˆ¤æ–­æ˜¯å¦æ˜¯ä»Šå¤©
            function æ˜¯å¦æ˜¯ä»Šå¤©(dateString) {
                if (!dateString) return false;
                const date = new Date(dateString);
                return date.toDateString() === today;
            }

            // åˆ¤æ–­ç–¯ç‹‚èµ›è½¦æ˜¯å¦å®Œæˆ
            // âœ… æ ‡å‡†ï¼šåªè¦è·å–äº†çŠ¶æ€ï¼ˆhasPlayed=true æˆ– å·²æ‰§è¡Œæ—¥æœŸä¸ä¸ºç©ºï¼‰å°±ç®—æ‰§è¡Œäº†
            function ç–¯ç‹‚èµ›è½¦æ˜¯å¦å®Œæˆ(status) {
                if (!status?.carKing) return false;

                const hasPlayed = status.carKing.hasPlayed || false;
                const å·²æ‰§è¡Œæ—¥æœŸ = status.carKing.å·²æ‰§è¡Œæ—¥æœŸ || [];

                // âœ… åªè¦ hasPlayed=true æˆ– å·²æ‰§è¡Œæ—¥æœŸä¸ä¸ºç©ºï¼Œå°±ç®—æ‰§è¡Œäº†
                if (hasPlayed || (Array.isArray(å·²æ‰§è¡Œæ—¥æœŸ) && å·²æ‰§è¡Œæ—¥æœŸ.length > 0)) {
                    return true;
                }

                return false;
            }

            // éå†æ‰€æœ‰è´¦å·
            tokens.forEach(token => {
                const accountName = token.name;
                const status = statusData[accountName];

                if (!status) return;

                // æ¯æ—¥ä»»åŠ¡
                const dailyPoint = status.dailyTask?.dailyPoint || 0;
                stats.dailyTaskTotalPoint += dailyPoint;
                if (dailyPoint >= 75) stats.dailyTask75++;
                if (dailyPoint >= 100) stats.dailyTask100++;

                // ç›ç½æœºå™¨äºº
                if (status.bottleHelper?.isRunning) {
                    stats.bottleHelper++;
                    // âœ… æ ¹æ®ç»å¯¹æ—¶é—´æˆ³è®¡ç®—å®é™…å‰©ä½™æ—¶é—´
                    const now = Date.now() / 1000; // å½“å‰æ—¶é—´ï¼ˆç§’ï¼‰
                    const helperStopTime = status.bottleHelper.helperStopTime || 0;
                    const actualRemainingTime = Math.max(0, Math.floor(helperStopTime - now));
                    stats.bottleHelperTotalRemaining += actualRemainingTime;
                    // âœ… ä¿å­˜å®æ—¶æ›´æ–°æ•°æ®ï¼ˆä½¿ç”¨ç»å¯¹æ—¶é—´æˆ³ï¼Œå‰ç«¯å¯ä»¥å®æ—¶è®¡ç®—ï¼‰
                    realTimeData.bottleHelper.accounts.push({
                        accountName: accountName,
                        helperStopTime: helperStopTime,  // ä¿å­˜ç»å¯¹æ—¶é—´æˆ³
                        remainingTime: actualRemainingTime  // å½“å‰è®¡ç®—çš„å‰©ä½™æ—¶é—´
                    });
                }

                // æŒ‚æœºçŠ¶æ€
                if (status.hangUp?.totalTime > 0) {
                    // âœ… æ ¹æ®ç»å¯¹æ—¶é—´æˆ³è®¡ç®—å®é™…å‰©ä½™æ—¶é—´å’Œå·²æŒ‚æ—¶é—´
                    const now = Date.now() / 1000; // å½“å‰æ—¶é—´ï¼ˆç§’ï¼‰
                    const lastTime = status.hangUp.lastTime || 0;
                    const hangUpTime = status.hangUp.hangUpTime || 0;
                    const actualElapsedTime = Math.max(0, Math.floor(now - lastTime));
                    const actualRemainingTime = Math.max(0, Math.floor(hangUpTime - actualElapsedTime));

                    if (actualRemainingTime > 0) {
                        stats.hangUp++;
                        stats.hangUpTotalRemaining += actualRemainingTime;
                        stats.hangUpTotalElapsed += actualElapsedTime;
                        // âœ… ä¿å­˜å®æ—¶æ›´æ–°æ•°æ®ï¼ˆä½¿ç”¨ç»å¯¹æ—¶é—´æˆ³ï¼Œå‰ç«¯å¯ä»¥å®æ—¶è®¡ç®—ï¼‰
                        realTimeData.hangUp.accounts.push({
                            accountName: accountName,
                            lastTime: lastTime,  // ä¿å­˜å¼€å§‹æ—¶é—´æˆ³
                            hangUpTime: hangUpTime,  // ä¿å­˜æ€»æ—¶é•¿
                            remainingTime: actualRemainingTime,  // å½“å‰è®¡ç®—çš„å‰©ä½™æ—¶é—´
                            elapsedTime: actualElapsedTime  // å½“å‰è®¡ç®—çš„å·²æŒ‚æ—¶é—´
                        });
                    }
                }

                // ä»Šæ—¥ç­¾åˆ°
                if (status.signin?.isSignedIn) stats.signin++;

                // æœ¬å‘¨ç­”é¢˜
                if (status.study?.hasAnswered) {
                    const beginTime = status.study.beginTime;
                    if (beginTime && æ˜¯å¦åœ¨æœ¬å‘¨å†…(new Date(beginTime * 1000).toISOString())) {
                        stats.study++;
                        stats.studyTotalScore += (status.study.score || 0);
                        stats.studyTotalCorrect += (status.study.maxCorrectNum || 0);
                    }
                }

                // ç–¯ç‹‚èµ›è½¦
                if (ç–¯ç‹‚èµ›è½¦æ˜¯å¦å®Œæˆ(status)) {
                    stats.carKing++;
                    const carKing = status.carKing || {};
                    stats.carKingTotalSent += (carKing.å·²å‘è½¦æ•°é‡ || 0);
                    stats.carKingTotalCanClaim += (carKing.å¯æ”¶è½¦æ•°é‡ || 0);
                    stats.carKingTotalTickets += (carKing.åˆ·æ–°åˆ¸æ•°é‡ || 0);
                    stats.carKingTotalCars += (carKing.æ€»è½¦è¾†æ•° || 0);
                }

                // å››åœ£ç¢ç‰‡è´­ä¹°ï¼ˆæœ¬å‘¨å·²è´­ä¹°ï¼‰
                const è´­ä¹°æ—¥æœŸ = status.legionShop?.è´­ä¹°æ—¥æœŸ;
                if (è´­ä¹°æ—¥æœŸ && æ˜¯å¦åœ¨æœ¬å‘¨å†…(è´­ä¹°æ—¥æœŸ)) {
                    const æ˜¾ç¤ºçŠ¶æ€ = status.legionShop?.æ˜¾ç¤ºçŠ¶æ€ || status.legionShop?.çŠ¶æ€;
                    if (æ˜¾ç¤ºçŠ¶æ€ === 'purchased' || æ˜¾ç¤ºçŠ¶æ€ === 'insufficient') {
                        stats.legionShop++;
                    }
                }

                // æ¯æ—¥å’¸ç‹ï¼ˆä»Šæ—¥å·²æ‰§è¡Œï¼‰
                const æœ€åæ‰§è¡Œæ—¶é—´ = status.æ¯æ—¥å’¸ç‹?.æœ€åæ‰§è¡Œæ—¶é—´;
                if (æœ€åæ‰§è¡Œæ—¶é—´ && æ˜¯å¦æ˜¯ä»Šå¤©(æœ€åæ‰§è¡Œæ—¶é—´)) {
                    stats.dailyBoss++;
                }

                // ç¯ç¥ï¼ˆä»Šæ—¥å·²æ‰§è¡Œï¼‰
                // âœ… ä¼˜å…ˆä»account-status.jsonè¯»å–ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä»task-schedule-record.jsonè¯»å–
                let ç¯ç¥æ‰§è¡Œæ—¶é—´ = status.ç¯ç¥?.æœ€åæ‰§è¡Œæ—¶é—´;
                if (!ç¯ç¥æ‰§è¡Œæ—¶é—´) {
                    ç¯ç¥æ‰§è¡Œæ—¶é—´ = executionRecord['ç¯ç¥']?.accounts?.[accountName]?.lastExecutionTime;
                }
                if (ç¯ç¥æ‰§è¡Œæ—¶é—´ && æ˜¯å¦æ˜¯ä»Šå¤©(ç¯ç¥æ‰§è¡Œæ—¶é—´)) {
                    stats.lampGod++;
                }

                // æ¢¦å¢ƒï¼ˆæœ¬å‘¨å·²æ‰§è¡Œï¼‰
                // âœ… ä¼˜å…ˆä»account-status.jsonè¯»å–ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä»task-schedule-record.jsonè¯»å–
                let æ¢¦å¢ƒæ‰§è¡Œæ—¶é—´ = status.æ¢¦å¢ƒ?.æœ€åæ‰§è¡Œæ—¶é—´;
                if (!æ¢¦å¢ƒæ‰§è¡Œæ—¶é—´) {
                    æ¢¦å¢ƒæ‰§è¡Œæ—¶é—´ = executionRecord['æ¢¦å¢ƒ']?.accounts?.[accountName]?.lastExecutionTime;
                }
                if (æ¢¦å¢ƒæ‰§è¡Œæ—¶é—´ && æ˜¯å¦åœ¨æœ¬å‘¨å†…(æ¢¦å¢ƒæ‰§è¡Œæ—¶é—´)) {
                    stats.dreamland++;
                }

                // ç«æŠ€åœºï¼ˆä»Šæ—¥å·²æ‰§è¡Œï¼‰
                // âœ… ä¼˜å…ˆä»account-status.jsonè¯»å–ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä»task-schedule-record.jsonè¯»å–
                let ç«æŠ€åœºæ‰§è¡Œæ—¶é—´ = status.arena?.lastExecuteTime;
                if (!ç«æŠ€åœºæ‰§è¡Œæ—¶é—´) {
                    ç«æŠ€åœºæ‰§è¡Œæ—¶é—´ = executionRecord['ç«æŠ€åœº']?.accounts?.[accountName]?.lastExecutionTime;
                }
                if (ç«æŠ€åœºæ‰§è¡Œæ—¶é—´ && æ˜¯å¦æ˜¯ä»Šå¤©(ç«æŠ€åœºæ‰§è¡Œæ—¶é—´)) {
                    stats.arena++;
                    const arena = status.arena || {};
                    stats.arenaTotalSuccess += (arena.successCount || 0);
                    stats.arenaTotalAttempt += (arena.attemptCount || 0);
                }

                // BOSSæˆ˜æ–—ï¼ˆä»Šæ—¥å·²æ‰§è¡Œï¼‰
                // âœ… ä¼˜å…ˆä»account-status.jsonè¯»å–ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä»task-schedule-record.jsonè¯»å–
                let BOSSæ‰§è¡Œæ—¶é—´ = status.BOSSæˆ˜æ–—?.æœ€åæ‰§è¡Œæ—¶é—´;
                if (!BOSSæ‰§è¡Œæ—¶é—´) {
                    BOSSæ‰§è¡Œæ—¶é—´ = executionRecord['BOSSæˆ˜æ–—']?.accounts?.[accountName]?.lastExecutionTime;
                }
                if (BOSSæ‰§è¡Œæ—¶é—´ && æ˜¯å¦æ˜¯ä»Šå¤©(BOSSæ‰§è¡Œæ—¶é—´)) {
                    stats.bossBattle++;
                }

                // å’¸å°†å¡”ç»Ÿè®¡
                const tower = status.tower;
                if (tower) {
                    // 6å°æ—¶å†…å·²æ‰§è¡Œ
                    const å¡”æ‰§è¡Œæ—¶é—´ = tower.lastExecuteTime;
                    if (å¡”æ‰§è¡Œæ—¶é—´) {
                        const æ‰§è¡Œæ—¶é—´ = new Date(å¡”æ‰§è¡Œæ—¶é—´);
                        const æ—¶é—´é—´éš” = now.getTime() - æ‰§è¡Œæ—¶é—´.getTime();
                        const é—´éš”å°æ—¶ = æ—¶é—´é—´éš” / (60 * 60 * 1000);
                        if (é—´éš”å°æ—¶ <= 6) {
                            stats.tower.executed++;
                        }
                    }

                    // å½“å¤©æŒ‘æˆ˜ç»Ÿè®¡
                    const today = tower.today || {};
                    stats.tower.totalChallenges += (today.challengeCount || 0);
                    stats.tower.totalSuccess += (today.successCount || 0);
                    stats.tower.totalFail += (today.failCount || 0);

                    // æœ‰èƒ½é‡çš„è´¦å·ï¼ˆenergy > 0ï¼‰
                    const energy = tower.energy || 0;
                    stats.tower.totalEnergy += energy;
                    if (energy > 0) {
                        stats.tower.hasEnergy++;
                    }

                    // æœ€é«˜å±‚æ•°
                    const towerId = tower.towerId || 0;
                    if (towerId > stats.tower.maxTowerId) {
                        stats.tower.maxTowerId = towerId;
                    }

                    // æœ¬å‘¨å±‚æ•°å˜åŒ–
                    const week = tower.week || {};
                    const initialTowerId = week.initialTowerId || tower.towerId || 0;
                    const currentTowerId = week.currentTowerId || tower.towerId || 0;
                    if (initialTowerId > 0 && currentTowerId > 0) {
                        const floorChange = currentTowerId - initialTowerId;
                        stats.tower.avgFloorChange += floorChange;
                    }
                }

                // âœ… æ´»åŠ¨å‘¨è´­ä¹°ç»Ÿè®¡ï¼ˆä»…é»‘å¸‚å‘¨ï¼‰
                stats.activityWeek.total++;
                if (stats.activityWeek.type === 'é»‘å¸‚å‘¨') {
                    const blackMarketWeek = status.blackMarketWeek;
                    if (blackMarketWeek && blackMarketWeek.è´­ä¹°æ—¥æœŸ) {
                        const è´­ä¹°æ—¶é—´ = new Date(blackMarketWeek.è´­ä¹°æ—¥æœŸ);
                        const å½“å‰æ´»åŠ¨å‘¨å¼€å§‹æ—¶é—´ = è®¡ç®—æ´»åŠ¨å‘¨å¼€å§‹æ—¶é—´(new Date());
                        if (è´­ä¹°æ—¶é—´.getTime() >= å½“å‰æ´»åŠ¨å‘¨å¼€å§‹æ—¶é—´) {
                            stats.activityWeek.purchased++;
                        }
                    }
                }
            });

            return stats;
        }

        // æ¸²æŸ“ç»Ÿè®¡å¡ç‰‡
        function renderStats(stats, totalAccounts, tokens, statusData) {
            const container = document.getElementById('statsContainer');

            // âœ… æ´»åŠ¨å‘¨å¡ç‰‡
            const å½“å‰æ´»åŠ¨å‘¨ç±»å‹ = stats.activityWeek.type;
            let æ´»åŠ¨å‘¨æ‰§è¡Œè®°å½• = 'æœªå¯åŠ¨';
            let æ´»åŠ¨å‘¨æ‰§è¡Œè®°å½•æ ·å¼ = 'gray';
            let æ´»åŠ¨å‘¨æ‰§è¡Œè®°å½•æ•°å€¼ = '0/0';

            if (å½“å‰æ´»åŠ¨å‘¨ç±»å‹ === 'é»‘å¸‚å‘¨') {
                const å·²è´­ä¹°æ•° = stats.activityWeek.purchased;
                const æ€»è´¦å·æ•° = stats.activityWeek.total;
                æ´»åŠ¨å‘¨æ‰§è¡Œè®°å½•æ•°å€¼ = `${å·²è´­ä¹°æ•°}/${æ€»è´¦å·æ•°}`;
                if (å·²è´­ä¹°æ•° === æ€»è´¦å·æ•° && æ€»è´¦å·æ•° > 0) {
                    æ´»åŠ¨å‘¨æ‰§è¡Œè®°å½• = 'å·²è´­ä¹°';
                    æ´»åŠ¨å‘¨æ‰§è¡Œè®°å½•æ ·å¼ = 'success';
                } else if (å·²è´­ä¹°æ•° > 0) {
                    æ´»åŠ¨å‘¨æ‰§è¡Œè®°å½• = 'éƒ¨åˆ†å·²è´­ä¹°';
                    æ´»åŠ¨å‘¨æ‰§è¡Œè®°å½•æ ·å¼ = 'warning';
                } else {
                    æ´»åŠ¨å‘¨æ‰§è¡Œè®°å½• = 'æœªæ‰§è¡Œ';
                    æ´»åŠ¨å‘¨æ‰§è¡Œè®°å½•æ ·å¼ = 'warning';
                }
            } else {
                æ´»åŠ¨å‘¨æ‰§è¡Œè®°å½• = 'æœªå¯åŠ¨';
                æ´»åŠ¨å‘¨æ‰§è¡Œè®°å½•æ ·å¼ = 'gray';
                æ´»åŠ¨å‘¨æ‰§è¡Œè®°å½•æ•°å€¼ = '-/-';
            }

            // è®¡ç®—å„ç§å¹³å‡å€¼å’Œæ ¼å¼åŒ–æ•°æ®
            const æœ‰å±‚æ•°å˜åŒ–çš„è´¦å·æ•° = tokens ? tokens.filter(token => {
                const status = statusData[token.name];
                if (!status?.tower) return false;
                const week = status.tower.week || {};
                const initialTowerId = week.initialTowerId || status.tower.towerId || 0;
                return initialTowerId > 0;
            }).length : 0;
            const avgFloorChange = æœ‰å±‚æ•°å˜åŒ–çš„è´¦å·æ•° > 0
                ? Math.round(stats.tower.avgFloorChange / æœ‰å±‚æ•°å˜åŒ–çš„è´¦å·æ•°)
                : 0;

            // âœ… æ ¼å¼åŒ–æ—¶é—´å‡½æ•°å·²åœ¨å…¨å±€å®šä¹‰ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨

            // æ ¼å¼åŒ–å±‚æ•°
            function æ ¼å¼åŒ–å±‚æ•°(id) {
                if (!id) return '-';
                const å±‚æ•° = Math.floor(id / 10) + 1;
                const å…³å¡ = id % 10;
                return `${å±‚æ•°}-${å…³å¡}`;
            }

            // è®¡ç®—å¹³å‡å€¼
            const avgDailyPoint = totalAccounts > 0 ? Math.round(stats.dailyTaskTotalPoint / totalAccounts) : 0;
            // âœ… å®æ—¶æ›´æ–°æ•°æ®ï¼šæ›´æ–°åŸºç¡€æ•°æ®
            realTimeData.bottleHelper.count = stats.bottleHelper;
            realTimeData.bottleHelper.totalRemaining = stats.bottleHelperTotalRemaining;
            realTimeData.hangUp.count = stats.hangUp;
            realTimeData.hangUp.totalRemaining = stats.hangUpTotalRemaining;
            realTimeData.hangUp.totalElapsed = stats.hangUpTotalElapsed;
            // åˆå§‹æ˜¾ç¤ºå€¼ï¼ˆä¼šè¢«å®æ—¶æ›´æ–°è¦†ç›–ï¼‰
            const avgBottleRemaining = stats.bottleHelper > 0 ? æ ¼å¼åŒ–æ—¶é—´(Math.round(stats.bottleHelperTotalRemaining / stats.bottleHelper)) : '0å°æ—¶';
            const avgHangUpRemaining = stats.hangUp > 0 ? æ ¼å¼åŒ–æ—¶é—´(Math.round(stats.hangUpTotalRemaining / stats.hangUp)) : '0å°æ—¶';
            const avgHangUpElapsed = stats.hangUp > 0 ? æ ¼å¼åŒ–æ—¶é—´(Math.round(stats.hangUpTotalElapsed / stats.hangUp)) : '0å°æ—¶';
            const avgStudyScore = stats.study > 0 ? Math.round(stats.studyTotalScore / stats.study) : 0;
            const avgStudyCorrect = stats.study > 0 ? Math.round(stats.studyTotalCorrect / stats.study) : 0;
            const avgArenaSuccess = stats.arena > 0 ? Math.round(stats.arenaTotalSuccess / stats.arena) : 0;
            const arenaSuccessRate = stats.arenaTotalAttempt > 0 ? Math.round((stats.arenaTotalSuccess / stats.arenaTotalAttempt) * 100) : 0;
            const towerSuccessRate = stats.tower.totalChallenges > 0 ? Math.round((stats.tower.totalSuccess / stats.tower.totalChallenges) * 100) : 0;
            const avgTowerEnergy = stats.tower.hasEnergy > 0 ? Math.round(stats.tower.totalEnergy / stats.tower.hasEnergy) : 0;
            const maxTowerFloor = æ ¼å¼åŒ–å±‚æ•°(stats.tower.maxTowerId);

            // æŒ‰åˆ†ç»„ç»„ç»‡å¡ç‰‡
            const sections = [
                {
                    title: 'ğŸ“Š åŸºç¡€ä¿¡æ¯',
                    cards: [
                        {
                            title: 'æ€»è´¦å·',
                            icon: 'ğŸ‘¥',
                            value: `${totalAccounts}`,
                            subtitle: `å…± ${totalAccounts} ä¸ªè´¦å·`,
                            progress: 100,
                            colorClass: 'success'
                        },
                        {
                            title: `æ´»åŠ¨å‘¨ - ${å½“å‰æ´»åŠ¨å‘¨ç±»å‹}`,
                            icon: 'ğŸ“…',
                            value: æ´»åŠ¨å‘¨æ‰§è¡Œè®°å½•æ•°å€¼,
                            subtitle: æ´»åŠ¨å‘¨æ‰§è¡Œè®°å½•,
                            progress: å½“å‰æ´»åŠ¨å‘¨ç±»å‹ === 'é»‘å¸‚å‘¨' && stats.activityWeek.total > 0
                                ? Math.round((stats.activityWeek.purchased / stats.activityWeek.total) * 100)
                                : 0,
                            colorClass: æ´»åŠ¨å‘¨æ‰§è¡Œè®°å½•æ ·å¼
                        }
                    ]
                },
                {
                    title: 'â° æŒç»­è¿è¡ŒçŠ¶æ€',
                    cards: [
                        {
                            title: 'ç›ç½æœºå™¨äºº',
                            icon: 'ğŸ¤–',
                            value: `${stats.bottleHelper}/${totalAccounts}`,
                            subtitle: stats.bottleHelper > 0 ? `å¹³å‡å‰©ä½™: ${avgBottleRemaining}` : 'æœªè¿è¡Œ',
                            subtitleId: 'bottle-helper-subtitle',  // âœ… æ·»åŠ IDç”¨äºå®æ—¶æ›´æ–°
                            progress: totalAccounts > 0 ? Math.round((stats.bottleHelper / totalAccounts) * 100) : 0,
                            colorClass: stats.bottleHelper === totalAccounts ? 'success' : stats.bottleHelper >= totalAccounts * 0.8 ? 'warning' : 'danger'
                        },
                        {
                            title: 'æŒ‚æœºçŠ¶æ€',
                            icon: 'â°',
                            value: `${stats.hangUp}/${totalAccounts}`,
                            subtitle: stats.hangUp > 0 ? `å¹³å‡å‰©ä½™: ${avgHangUpRemaining} | å¹³å‡å·²æŒ‚: ${avgHangUpElapsed}` : 'æœªè¿è¡Œ',
                            subtitleId: 'hangup-subtitle',  // âœ… æ·»åŠ IDç”¨äºå®æ—¶æ›´æ–°
                            progress: totalAccounts > 0 ? Math.round((stats.hangUp / totalAccounts) * 100) : 0,
                            colorClass: stats.hangUp === totalAccounts ? 'success' : stats.hangUp >= totalAccounts * 0.8 ? 'warning' : 'danger'
                        }
                    ]
                },
                {
                    title: 'ğŸ“ æ¯æ—¥ä»»åŠ¡',
                    cards: [
                        {
                            title: 'æ¯æ—¥ä»»åŠ¡ 75è¿›åº¦å€¼',
                            icon: 'ğŸ“',
                            value: `${stats.dailyTask75}/${totalAccounts}`,
                            subtitle: `å¹³å‡è¿›åº¦: ${avgDailyPoint} | 100å®Œæˆ: ${stats.dailyTask100}`,
                            progress: totalAccounts > 0 ? Math.round((stats.dailyTask75 / totalAccounts) * 100) : 0,
                            colorClass: stats.dailyTask75 === totalAccounts ? 'success' : stats.dailyTask75 >= totalAccounts * 0.8 ? 'warning' : 'danger'
                        },
                        {
                            title: 'æ¯æ—¥ä»»åŠ¡ 100è¿›åº¦å€¼',
                            icon: 'âœ…',
                            value: `${stats.dailyTask100}/${totalAccounts}`,
                            subtitle: `å¹³å‡è¿›åº¦: ${avgDailyPoint} | 75å®Œæˆ: ${stats.dailyTask75}`,
                            progress: totalAccounts > 0 ? Math.round((stats.dailyTask100 / totalAccounts) * 100) : 0,
                            colorClass: stats.dailyTask100 === totalAccounts ? 'success' : stats.dailyTask100 >= totalAccounts * 0.8 ? 'warning' : 'danger'
                        },
                        {
                            title: 'ä»Šæ—¥ç­¾åˆ°',
                            icon: 'ğŸ“…',
                            value: `${stats.signin}/${totalAccounts}`,
                            progress: totalAccounts > 0 ? Math.round((stats.signin / totalAccounts) * 100) : 0,
                            colorClass: stats.signin === totalAccounts ? 'success' : stats.signin >= totalAccounts * 0.8 ? 'warning' : 'danger'
                        },
                        {
                            title: 'ç«æŠ€åœº',
                            icon: 'âš”ï¸',
                            value: `${stats.arena}/${totalAccounts}`,
                            subtitle: stats.arena > 0 ? `å¹³å‡æˆåŠŸ: ${avgArenaSuccess}æ¬¡ | æˆåŠŸç‡: ${arenaSuccessRate}%` : 'ä»Šæ—¥æœªæ‰§è¡Œ',
                            progress: totalAccounts > 0 ? Math.round((stats.arena / totalAccounts) * 100) : 0,
                            colorClass: stats.arena === totalAccounts ? 'success' : stats.arena >= totalAccounts * 0.8 ? 'warning' : 'danger'
                        },
                        {
                            title: 'BOSSæˆ˜æ–—',
                            icon: 'ğŸ‘¹',
                            value: `${stats.bossBattle}/${totalAccounts}`,
                            progress: totalAccounts > 0 ? Math.round((stats.bossBattle / totalAccounts) * 100) : 0,
                            colorClass: stats.bossBattle === totalAccounts ? 'success' : stats.bossBattle >= totalAccounts * 0.8 ? 'warning' : 'danger'
                        },
                        {
                            title: 'æ¯æ—¥å’¸ç‹',
                            icon: 'ğŸ‘‘',
                            value: `${stats.dailyBoss}/${totalAccounts}`,
                            progress: totalAccounts > 0 ? Math.round((stats.dailyBoss / totalAccounts) * 100) : 0,
                            colorClass: stats.dailyBoss === totalAccounts ? 'success' : stats.dailyBoss >= totalAccounts * 0.8 ? 'warning' : 'danger'
                        },
                        {
                            title: 'ç¯ç¥æ‰«è¡åˆ¸',
                            icon: 'ğŸª”',
                            value: `${stats.lampGod}/${totalAccounts}`,
                            progress: totalAccounts > 0 ? Math.round((stats.lampGod / totalAccounts) * 100) : 0,
                            colorClass: stats.lampGod === totalAccounts ? 'success' : stats.lampGod >= totalAccounts * 0.8 ? 'warning' : 'danger'
                        },
                        {
                            title: 'å’¸å°†å¡”',
                            icon: 'ğŸ—¼',
                            value: `${stats.tower.executed}/${totalAccounts}`,
                            subtitle: `æŒ‘æˆ˜:${stats.tower.totalChallenges} æˆåŠŸ:${stats.tower.totalSuccess}(${towerSuccessRate}%) å¤±è´¥:${stats.tower.totalFail} | æœ‰èƒ½é‡:${stats.tower.hasEnergy}(${avgTowerEnergy}ç‚¹) | æœ€é«˜:${maxTowerFloor} | æœ¬å‘¨å¹³å‡æå‡:${avgFloorChange}å±‚`,
                            progress: totalAccounts > 0 ? Math.round((stats.tower.executed / totalAccounts) * 100) : 0,
                            colorClass: stats.tower.executed === totalAccounts ? 'success' : stats.tower.executed >= totalAccounts * 0.8 ? 'warning' : 'danger'
                        }
                    ]
                },
                {
                    title: 'ğŸ“… å‘¨æœŸæ€§ä»»åŠ¡',
                    cards: [
                        {
                            title: 'æœ¬å‘¨ç­”é¢˜',
                            icon: 'ğŸ“š',
                            value: `${stats.study}/${totalAccounts}`,
                            subtitle: stats.study > 0 ? `å¹³å‡åˆ†æ•°: ${avgStudyScore} | å¹³å‡ç­”å¯¹: ${avgStudyCorrect}é¢˜` : 'æœªç­”é¢˜',
                            progress: totalAccounts > 0 ? Math.round((stats.study / totalAccounts) * 100) : 0,
                            colorClass: stats.study === totalAccounts ? 'success' : stats.study >= totalAccounts * 0.8 ? 'warning' : 'danger'
                        },
                        {
                            title: 'ç–¯ç‹‚èµ›è½¦',
                            icon: 'ğŸï¸',
                            value: `${stats.carKing}/${totalAccounts}`,
                            subtitle: stats.carKing > 0 ? `å·²å‘è½¦:${stats.carKingTotalSent} å¯æ”¶è½¦:${stats.carKingTotalCanClaim} | åˆ·æ–°åˆ¸:${stats.carKingTotalTickets} | æ€»è½¦è¾†:${stats.carKingTotalCars}` : 'æœªæ‰§è¡Œ',
                            progress: totalAccounts > 0 ? Math.round((stats.carKing / totalAccounts) * 100) : 0,
                            colorClass: stats.carKing === totalAccounts ? 'success' : stats.carKing >= totalAccounts * 0.8 ? 'warning' : 'danger'
                        },
                        {
                            title: 'å››åœ£ç¢ç‰‡è´­ä¹°',
                            icon: 'ğŸ’',
                            value: `${stats.legionShop}/${totalAccounts}`,
                            progress: totalAccounts > 0 ? Math.round((stats.legionShop / totalAccounts) * 100) : 0,
                            colorClass: stats.legionShop === totalAccounts ? 'success' : stats.legionShop >= totalAccounts * 0.8 ? 'warning' : 'danger'
                        },
                        {
                            title: 'æ¢¦å¢ƒ',
                            icon: 'ğŸ’¤',
                            value: `${stats.dreamland}/${totalAccounts}`,
                            progress: totalAccounts > 0 ? Math.round((stats.dreamland / totalAccounts) * 100) : 0,
                            colorClass: stats.dreamland === totalAccounts ? 'success' : stats.dreamland >= totalAccounts * 0.8 ? 'warning' : 'danger'
                        }
                    ]
                }
            ];

            container.innerHTML = sections.map(section => `
                <div class="section-group">
                    <div class="section-title">${section.title}</div>
                    <div class="stats-grid">
                        ${section.cards.map(card => `
                            <div class="stat-card">
                                <div class="stat-header">
                                    <div class="stat-title">${card.title}</div>
                                    <div class="stat-icon">${card.icon}</div>
                                </div>
                                <div class="stat-value ${card.colorClass}">${card.value}</div>
                                ${card.subtitle ? `<div id="${card.subtitleId || ''}" style="font-size: 12px; color: #666; margin-top: 4px; margin-bottom: 8px; line-height: 1.4;">${card.subtitle}</div>` : ''}
                                <div class="stat-progress">
                                    <div class="stat-progress-bar ${card.colorClass}" style="width: ${card.progress}%"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        // âœ… é¡µé¢åŠ è½½å®Œæˆæ ‡è®°
        console.log('=== é¡µé¢è„šæœ¬åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ– ===');

        // âœ… å¯åŠ¨å®æ—¶æ›´æ–°ï¼ˆç«‹å³å¯åŠ¨ï¼Œå³ä½¿æ•°æ®è¿˜æ²¡åŠ è½½ï¼‰
        console.log('å‡†å¤‡å¯åŠ¨å®æ—¶æ›´æ–°å®šæ—¶å™¨...');
        startRealTimeUpdate();

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½æ•°æ®
        console.log('å‡†å¤‡åŠ è½½æ•°æ®...');
        loadData();

        // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°æ•°æ®ï¼ˆä¸åˆ·æ–°é¡µé¢ï¼‰
        function startAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            autoRefreshInterval = setInterval(() => {
                if (!isRefreshing) {
                    loadData();
                }
            }, 30000); // 30ç§’
        }

        // å¯åŠ¨è‡ªåŠ¨åˆ·æ–°
        startAutoRefresh();

        // é¡µé¢å¯è§æ€§å˜åŒ–æ—¶ï¼Œå¦‚æœé¡µé¢é‡æ–°å¯è§ï¼Œç«‹å³åˆ·æ–°ä¸€æ¬¡
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && !isRefreshing) {
                loadData();
            }
        });
    </script>
</body>

</html>